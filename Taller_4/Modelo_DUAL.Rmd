---
title: "Taller 3 - Modelo Regresión Multinomial"
author:
  - name: "Jhon Fernando Tascon Velasco"
  - name: "Lino Alexander Sinisterra"
  - name: "Juan Sebastián Chacon"
date: "2025-09-29"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
library(readxl)
library(dplyr)
library(tidyverse)
library(plotly)
library(ggcorrplot)
library(ggplot2)
library(reshape2)
library(ResourceSelection)
library(knitr)
library(kableExtra)
library(FactoMineR)
library(scales)
```

## **0. Información general**

En este trabajo se realizará un análisis factorial multiple con el fin de examinar trayectorias y agrupamientos de diferentes variables económicas, para identificar factores latentes, similitudes y diferencias a lo largo de los últimos cinco años (2020 al 2024), desagregado por regiones geográficas. Los datos están a nivel país, pero se realizó un procedimiento para agrupar los países en 14 regiones, con base en sus similitudes geográficas y étnicas. Las regiones son: Asia del Sur, Oriente Medio, Asia del Este y Pacífico, Asia Central, Balcanes, Europa Occidental, Europa del Este, Europa Central y los bálticos, África Central y Occidental, Norte de África, África Oriental y Sur, Latinoamérica y el Caribe, Norteamérica y Oceanía. 

Las variables a analizar son las siguientes:

```{r tabla_variables, echo=FALSE}
variables <- data.frame(
  Variables = c(
    "Pais",
    "Año",
    "Region",
    "Gasto_Salud",
    "Gasto_ID",
    "Gasto_Militar",
    "Gasto_Educacion",
    "Ahorro",
    "Exportaciones",
    "Importaciones",
    "Industria",
    "Inversion_Extranjera_Entrada",
    "Inversion_Extranjera_Salida",
    "Deuda",
    "Recaudacion_Impuestos",
    "Agricultura",
    "Remesas"
  ),
  Tipo_Variable = c(
    "Nominal",
    "Ordinal",
    "Nominal",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa"
  ),
  Descripción = c(
    "País",
    "Año",
    "Región",
    "Gato en salud (% PIB)",
    "Gasto en Investigación y desarrollo (% PIB)",
    "Gasto militar (% PIB)",
    "Gasto en Educación (% PIB)",
    "Ahorro bruto (% PIB)",
    "Exportaciones de bienes y sevicios (% PIB)",
    "Importaciones de bienes y servicios (% PIB)",
    "Industria, valor agregado (% PIB)",
    "Inversión extranjera, entrada neta de capital (% PIB)",
    "Inversión extranjera, salidad neta de capital (% PIB)",
    "Total Deuda (% PIB)",
    "Recaudación impostivia (% PIB)",
    "Agricultura, silvicultura y pesca, valor agregado (% PIB)",
    "Remesas de trabajdores y compensación de empleados recibidas (% PIB)"
  )
)

kable(variables, format = "html", caption = "Descripción de variables del estudio", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = FALSE, position = "center")
```

## **1. Análisis exploratorio**

```{r carga_datos, echo=FALSE}
df = read_excel("Datos.xlsx", sheet="Data", na="..")
```

### **1.1. Revisión de datos faltantes**

```{r nulos, echo=FALSE}
# Revisar si hay faltantes
nulos = colSums(is.na(df))

kable(nulos, caption = "Datos faltantes") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Se identifica una cantidad significativa de valores faltantes en las series numéricas, se realizará un proceso de imputación de variables que incluirá:

- Interpolación de variables.
- Exclusión de registros, en los casos en los que todos los datos sean faltanas para las series numéricas.
- Eliminación de variables, si la cantidad sigue siendo significativa.

### **1.2. Resumen de las variables**

```{r descripcion, echo=FALSE}

#resumen = summary(df)
#kable(resumen, caption = "Descripción del conjunto de datos") %>%
#  kable_styling(bootstrap_options = c("striped", "hover"))
```

Hallazgos

#### **Variables numéricas**

```{r numericas, fig.width=10, fig.height=10, fig.align='center', echo=FALSE, message=FALSE}
#cat("\n")
## Crear boxplots con facetas
#df_long = df %>%
#  dplyr::select(Tiempo_Espera,
#                Costo_Viaje,
#                Tiempo_Viaje,
#                Costo_Generalizado,
#                Ingresos_Hogar)
#
#df_long = pivot_longer(
#  df_long,
#  cols = c(Tiempo_Espera,
#          Costo_Viaje,
#          Tiempo_Viaje,
#          Costo_Generalizado,
#          Ingresos_Hogar),
#  names_to = "Variable",
#  values_to = "Valor"
#)
#
#histogramas = ggplot(df_long, aes(x = Valor, fill = Variable)) +
#  geom_histogram(bins=15) +
#  facet_wrap(~Variable, scales = "free") +
#  theme_light() +
#  theme(legend.position = "none",
#    plot.title = element_text(hjust = 0.5)) +
#  labs(title="Histogramas de las variables numéricas")
#histogramas
```

Hallazgos

```{r numericas_2, fig.width=10, fig.height=10, fig.align='center', echo=FALSE, message=FALSE}
#boxplots = ggplot(df_long, aes(y = Valor, fill = Variable)) +
#  geom_boxplot() +
#  facet_wrap(~Variable, scales = "free") +
#  theme_light() +
#  theme(legend.position = "none",
#    plot.title = element_text(hjust = 0.5)) +
#  labs(title = "Boxplots de las variables numéricas")
#boxplots
```

Hallazgos

### **1.3. Análisis bivariado**

#### **Variables numéricas vs. Año y Región**

```{r bivariado, fig.align='center', echo=FALSE}
#cat("\n")
#df_long = df %>%
#  dplyr::select(Tiempo_Espera,
#                Costo_Viaje,
#                Tiempo_Viaje,
#                Costo_Generalizado,
#                Ingresos_Hogar,
#                Modo_Viaje)
#
#
#df_long <- df_long %>%
#  pivot_longer(cols = c(Tiempo_Espera,
#                Costo_Viaje,
#                Tiempo_Viaje,
#                Costo_Generalizado,
#                Ingresos_Hogar),
#               names_to = "Variable",
#               values_to = "Valor")
#
## Crear el gráfico de boxplots
#boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Modo_Viaje)) +
#geom_boxplot() +
#  facet_wrap(~Variable, scales = "free") +
#  theme_light() +
#  theme(plot.title = element_text(hjust = 0.5)) +
#  labs(title = "Distribución de las variables numéricas con el Modo de transporte")
#boxplots
```

Hallazgos

```{r correlacion, fig.align='center', echo=FALSE}
#df_sel = df %>%
#  dplyr::select(Tiempo_Espera,
#                Costo_Viaje,
#                Tiempo_Viaje,
#                Costo_Generalizado,
#                Ingresos_Hogar)#

## Calcula la matriz de correlación
#corr_matrix = round(cor(df_sel), 2)#

#ggcorrplot(corr_matrix,
#  lab = TRUE,             # Muestra los coeficientes de correlación en el gráfico
#  type = "lower",         # Muestra solo la matriz triangular inferior
#  outline.col = "white",  # Color del borde de los cuadrados
#  ggtheme = ggplot2::theme_gray, # Tema de ggplot
#  colors = c("#6D9EC1", "white", "#E46726") # Colores para correlaciones negativas, cero y positivas
#) +
#labs(title = "Matriz de Correlación") +
#theme(
#  plot.title = element_text(hjust = 0.5, face = "bold", size = 14)
#)
```

Hallazgos

## **2. Análisis factorial múltiple**

```{r modelo, echo=FALSE}
#BaseDUAL = BaseG7BRICS[,-1]
#
#res.dmfa = DMFA(BaseDUAL,
#                 num.fact = 2,
#                 quali.sup = 1,
#                 graph = FALSE
#)
#
#
#res.dmfa
#
#
#res.dmfa$eig # Valores propios (varianza explicada por cada eje)
#res.dmfa$var  # Cargas de las variables
#res.dmfa$var.partiel # Contribuciones parciales de las variables por grupo
#
#
#
## Muestra a los individuos (países) en el plano factorial.
#plot.DMFA(res.dmfa, choix="ind",invisible="quali", label="none",new.plot=TRUE)
#
## Muestra cómo las variables se proyectan en el plano.
#plot.DMFA(res.dmfa, choix="var",invisible="quali", label="none",new.plot=TRUE)
#
## Muestra la proyección de los grupos (como G7 vs BRICS).
#plot.DMFA(res.dmfa, choix="group",invisible="quali", label="none",new.plot=TRUE)
#
## Visualiza las modalidades de la variable cualitativa.
#plot.DMFA(res.dmfa, choix="quali",invisible="quali", label="none",new.plot=TRUE)
```

Hallazgos
