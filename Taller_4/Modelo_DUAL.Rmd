---
title: "Taller 4 - Modelo DUAL"
author:
  - name: "Jhon Fernando Tascon Velasco"
  - name: "Lino Alexander Sinisterra"
  - name: "Juan Sebastian Chac√≥n"
date: "2025-09-29"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
library(readxl)
library(dplyr)
library(tidyverse)
library(plotly)
library(ggcorrplot)
library(ggplot2)
library(reshape2)
library(ResourceSelection)
library(knitr)
library(kableExtra)
library(FactoMineR)
library(scales)
library(zoo)
library(factoextra)
```

## **0. Informaci√≥n general**

- ***Unidad de Estudio (Individuos):***	La unidad de observaci√≥n b√°sica es el pa√≠s, pero los resultados se interpretan a nivel de regi√≥n, dado que los pa√≠ses han sido agrupados en nueve regiones geogr√°ficas y √©tnicas. Las reguines son: Asia Central y del Sur, Oriente Medio, Asia del Este, Pac√≠fico y Ocean√≠a, Europa Occidental, Europa del Este, Norte de √Åfrica, √Åfrica Subsahariana, Latinoam√©rica y el Caribe y Norteam√©rica. 

- ***Horizonte Temporal:***	El estudio abarca un periodo de cinco a√±os (2019 al 2023). Este marco es cr√≠tico, ya que incluye el impacto y la recuperaci√≥n de la crisis global iniciada en 2020, lo que potencia el an√°lisis de trayectorias.

- ***Variables Activas (Cuantitativas):***	Se emplear√°n 13 variables econ√≥micas (e.g., Servicios, Gastos, Deuda, Exportaciones, Remesas) para construir el espacio factorial. Todas son expresadas como porcentaje del PIB (%), asegurando que miden la estructura econ√≥mica relativa y no el tama√±o absoluto.

- ***Variables de Agrupamiento/Clasificaci√≥n:***	El an√°lisis est√° desagregado por nueve Regiones geogr√°ficas predefinidas (e.g., Latinoam√©rica y el Caribe, Europa Occidental, √Åfrica Subsahariana), lo que facilita una interpretaci√≥n geopol√≠tica de los resultados.

Las variables a analizar son las siguientes:

```{r tabla_variables, echo=FALSE}
variables <- data.frame(
  Variables = c(
    "Pais",
    "A√±o",
    "Region",
    "Servicios",
    "Gastos",
    "Ahorro",
    "Exportaciones",
    "Importaciones",
    "Produccion",
    "Inversion_Extranjera_Entrada",
    "Inversion_Extranjera_Salida",
    "Deuda",
    "Recaudacion_Impuestos",
    "Agricultura",
    "Remesas",
    "Gastos_Militares"
  ),
  Tipo_Variable = c(
    "Nominal",
    "Ordinal",
    "Nominal",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa"
  ),
  Descripci√≥n = c(
    "Pa√≠s",
    "A√±o",
    "Regi√≥n",
    "Servicios, valor agregado (% PIB)",
    "Gastos (% PIB)",
    "Ahorro bruto (% PIB)",
    "Exportaciones de bienes y sevicios (% PIB)",
    "Importaciones de bienes y servicios (% PIB)",
    "Producci√≥n, valor agregado (% PIB)",
    "Inversi√≥n extranjera, entrada neta de capital (% PIB)",
    "Inversi√≥n extranjera, salidad neta de capital (% PIB)",
    "Total Deuda (% PIB)",
    "Recaudaci√≥n impostivia (% PIB)",
    "Agricultura, silvicultura y pesca, valor agregado (% PIB)",
    "Remesas de trabajdores y compensaci√≥n de empleados recibidas (% PIB)",
    "Gastos militares (%PIB)"
  )
)

kable(variables, format = "html", caption = "Descripci√≥n de variables del estudio", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = FALSE, position = "center")
```

## **1. An√°lisis exploratorio**

```{r carga_datos, echo=FALSE}
df = read_excel("Datos.xlsx", sheet="Data", na="..")
df = df %>%
  mutate(
    Servicios = as.numeric(Servicios),
    Gastos = as.numeric(Gastos),
    Ahorro = as.numeric(Ahorro),
    Exportaciones = as.numeric(Exportaciones),
    Importaciones = as.numeric(Importaciones),
    Produccion = as.numeric(Produccion),
    Inversion_Extranjera_Entrada = as.numeric(Inversion_Extranjera_Entrada),
    Inversion_Extranjera_Salida = as.numeric(Inversion_Extranjera_Salida),
    Deuda = as.numeric(Deuda),
    Recaudacion_Impuestos = as.numeric(Recaudacion_Impuestos),
    Agricultura = as.numeric(Agricultura),
    Remesas = as.numeric(Remesas),
    Gastos_Militares = as.numeric(Gastos_Militares)
  )
```

### **1.1. Revisi√≥n de datos faltantes**

```{r nulos, echo=FALSE}
# Revisar si hay faltantes
nulos = colSums(is.na(df))

kable(nulos, caption = "Datos faltantes") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

***Limpiar faltantes:*** El proceso de aseguramiento de la calidad de los datos es fundamental antes de aplicar el An√°lisis Factorial M√∫ltiple Dual (DMFA). La fase de limpieza de nulos se centra en la correcta identificaci√≥n y conversi√≥n de los valores ausentes (.. a NA). Para mejorar la robustez del modelo, es imperativo eliminar registros completos si estos carecen de datos en la totalidad de las variables activas, o considerar la eliminaci√≥n de variables cuyo volumen de nulos sea tan extremo que comprometa la estructura factorial. No obstante, para preservar las trayectorias de los pa√≠ses y mantener la m√°xima cantidad de informaci√≥n valiosa, el m√©todo preferido para los pocos nulos restantes ser√° la imputaci√≥n de datos faltantes. a conitnuaci√≥n, se detalla el paso a paso realizado para la limpiea de datos faltantes:

- Interpolaci√≥n de variables, usando el m√©todo na.spline.
- Exclusi√≥n de registros, en los casos en los que todos los datos sean faltantes para las series num√©ricas.
- Eliminaci√≥n de variables, si la cantidad sigue siendo significativa: una cantidad mayor a 40% de datos faltantes ser√°n eliminadas.
- Si quedan faltantes en algunos pa√≠ses, se imputar√°n los registros con base en la mediana de la regi√≥n al que pertenecen y el a√±o.

```{r limpieza_nulos, echo=FALSE}
# Limpiar faltantes
df_clean = df %>%
  group_by(Pais) %>%
  arrange(A√±o) %>%
  mutate(across(where(is.numeric), ~na.spline(.x, x=A√±o, na.rm = FALSE))) %>%
  mutate(A√±o = as.character(A√±o))

# Eliminar registros completos si todas las filas son faltantes
df_clean <- df_clean %>%
  ungroup() %>%  # Desagrupa para evitar conflictos
  filter(rowSums(!is.na(select(., where(is.numeric)))) > 0)

# Eliminaci√≥n de variables
df_clean = df_clean %>%
  select(where(~ mean(is.na(.)) <= 0.4))

# Imputaci√≥n de datos faltantes
df_clean = df_clean %>%
  group_by(A√±o, Region) %>%
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), median(. , na.rm = TRUE), .))) %>%
  mutate(A√±o = as.character(A√±o))

df_clean = df_clean %>%
  ungroup()
```


```{r nulos2, echo=FALSE}
# Revisar si hay faltantes
nulos = colSums(is.na(df_clean))

kable(nulos, caption = "Datos faltantes") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Con los datos limpios, se procede a hacer el an√°lisis exploratorio.

### **1.2. An√°lisis multivariado**

#### **Variables num√©ricas vs. A√±o y Regi√≥n**

##### **An√°lisis general por regi√≥n**
```{r multivariado_general, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gr√°fico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
  geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"), # centrado y negrilla
    strip.text = element_text(face = "bold", hjust = 0.5)  # t√≠tulos de facetas en negrilla y centrados
  ) +
  labs(title = "Distribuci√≥n de las variables num√©ricas por regi√≥n")
print(boxplots)
```

En t√©rminos generales, haciendo una desagregaci√≥n de cada variable econ√≥mica por regi√≥n, se puede decir que:

```{r multivariado_general_analisis, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
analisis_multivariado_general = data.frame(
  "Hallazgo Clave por Variable" = c(
    "Estructura Productiva (Agricultura/Producci√≥n/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "√Åfrica Subsahariana y Asia Central/Sur: Alta dependencia agr√≠cola (valores altos y dispersos).\nNorteam√©rica y Europa Occidental son regiones que se destacan con valores altos en el rubro de servicios, y los pa√≠ses de Lationam√©rica tambi√©n es destacable lo que aporta el sector servicio en el PIB de estos pa√≠ses. Por otro lado, √Åfrica Subsahariana y Asia Central/Sur tienen los valores m√°s bajos. En producci√≥n, las regiones son similares, pero Norteam√©rica es la regi√≥n m√°s baja en este rubro.",
    "En general, los pa√≠ses asi√°ticos al parecen tienen una mayor tendencia al ahorro, con base en la mediana de estas regiones con respecto a las dem√°s regiones. Destacan Asia del Este y Europa Occidental, con mayor tendencia al Ahorro y variabilidad.\n√Åfrica Subsahariana y Norte de √Åfrica: Valores de Ahorro m√°s bajos.\nEn cuanto a recaudaci√≥n de impuestos, Europa Occidental presenta una mediana elevada en esta variable, mientras Oriente Medio el que tiene la mediana m√°s baja.",
    "Europa (Occidental/Este): mayor integraci√≥n comercial (Altas Exportaciones e Importaciones).\nNorteam√©rica/Asia del Este: Grandes Importadores.",
    "Latinoam√©rica y el Caribe y Asia Central/Sur: Valores altos y dependencia estructural de Remesas.",
    "Oriente Medio: Alta prioridad y gasto en la dimensi√≥n militar.\nNorteam√©rica y Europa Occidental: Alto Gasto Total del gobierno."
  )
)

# Generamos la tabla con kableExtra
kable(
  analisis_multivariado_general,
  format = "html",
  align = "l",
  caption = "An√°lisis de Patrones de Variables por Regi√≥n (General)",
  col.names = c("Hallazgo Clave por Variable", "Patrones Destacados")
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )
```

##### **A√±o 2019**
```{r multivariado_2019, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(A√±o == "2019") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gr√°fico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold")  # centrado + negrilla
  ) +
  labs(title = "Distribuci√≥n de las variables num√©ricas por regi√≥n para el a√±o 2019")
boxplots
```

Haciendo un an√°lisis por regi√≥n, para el a√±o 2019 se tiene lo siguiente:
```{r analisis_multivariado_2019, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")
analisis_2019 = data.frame(
  Categoria = c(
    "Estructura Productiva (Agricultura/Producci√≥n/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "Agricultura: muy alta y dispersa en √Åfrica Subsahariana y Asia Central/Sur; baja y estable en Europa Occidental y Norteam√©rica.\nProducci√≥n: Norteam√©rica, Europa Occidental y Asia del Este/Pac√≠fico por encima de las dem√°s regiones; √Åfrica Subsahariana y Asia Central/Sur rezagadas.\nServicios: altos en Europa Occidental y Norteam√©rica; medios-altos en Asia del Este/Pac√≠fico; bajos en √Åfrica Subsahariana y Asia Central/Sur.\n\n En t√©rminos generales, se mantienen los mismos patrones y las jerarqu√≠as regionales comparado con el an√°lisis global (sin temporalidad), reforzando el patr√≥n global, con contrastes m√°s marcados (especialmente en Agricultura alta en regiones emergentes y Servicios/Producci√≥n altos en avanzadas).",
    "Recaudaci√≥n: alta y consistente en Europa Occidental y Norteam√©rica; baja y muy heterog√©nea en √Åfrica Subsahariana y Asia Central/Sur; intermedia en Latinoam√©rica.\nAhorro: alto en Asia del Este/Pac√≠fico y Europa Occidental; bajo en √Åfrica Subsahariana; variabilidad visible en Europa del Este y Latinoam√©rica.\nsimilar al grupo anterior, 2019 mantiene consistencia con el an√°lisis sin temporalidad, pero se observa un poco m√°s de heterogeneidad intra-regional en regiones de menor ingreso.",
    "Exportaciones/Importaciones con medianas altas en Europa Occidental, Norteam√©rica y Asia del Este/Pac√≠fico; bajas en √Åfrica Subsahariana y Asia Central/Sur. Latinoam√©rica y Europa del Este muestran dispersi√≥n notable (combinaci√≥n de econom√≠as muy abiertas y otras menos).\nEn general, 2019 es congruente con el patr√≥n sin temporalidad; resalta m√°s heterogeneidad en regiones intermedias (LatAm o Europa del Este).",
    "Muy altas (y muy dispersas) en Asia Central/Sur y Latinoam√©rica; bajas o casi nulas en Europa Occidental, Norteam√©rica y Asia del Este/Pac√≠fico. Distribuciones con colas superiores marcadas por pa√≠ses puntuales en estas regiones.\n Esta categoria ern el a√±o 2019 replica el patr√≥n sin temporalidad.",
    "Gasto total: alto en Norteam√©rica y Europa Occidental; bajo en √Åfrica Subsahariana; intermedio en Latinoam√©rica y Europa del Este.\nGasto militar: Oriente Medio muestra valores muy elevados con outliers pronunciados; Norteam√©rica alto pero m√°s estable; las dem√°s regiones en niveles moderados a bajos.\n El a√±o 2019 acent√∫a los picos de gasto militar en Oriente Medio (debido a la constante tensi√≥n con Israeel y sus pa√≠ses vecinos) y mantiene el liderazgo de gasto total en regiones avanzadas."
  )
)

# Generamos la tabla con kableExtra
kable(
  analisis_2019,
  format = "html",
  align = "l",
  caption = "An√°lisis de Patrones Regionales - A√±o 2019",
  col.names = c("Categor√≠a", "Patrones Destacados")   # üëà ESTA ES LA L√çNEA NUEVA
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )

```

##### **A√±o 2020**
```{r multivariado_2020, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(A√±o == "2020") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gr√°fico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold")  # centrado + negrilla
  ) +
  labs(title = "Distribuci√≥n de las variables num√©ricas por regi√≥n para el a√±o 2020")
boxplots
```

Para el 2020, la pandemia del COVID-19 afect√≥  los gastos, recaudaci√≥n de impuestos o ahorros. sin embargo, los patrones siguen siendo similares al an√°lisis sin temporalidad. A continuaci√≥n, se resumen los hallazgos:
```{r analisis_multivariado_2020, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")
analisis_2020 = data.frame(
  Categoria = c(
    "Estructura Productiva (Agricultura/Producci√≥n/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "En el 2020, √Åfrica Subsahariana y Asia Central/Sur mantienen sus patrones con Agricultura alta y dispersa; Europa Occidental y Norteam√©rica con Agricultura baja y estable.\nProducci√≥n/Servicios altos y m√°s compactos en Europa Occidental, Norteam√©rica y Asia del Este/Pac√≠fico, pero ligeramente m√°s bajos que el 2019 (efecto pandemia); bajos en √Åfrica Subsahariana y Asia Central/Sur; mayor heterogeneidad en regiones emergentes.\nComparando con el 2019 y patr√≥n sin temporalidad, se mantienen las jerarqu√≠as regionales, aunque en 2020 se observan contrastes algo m√°s marcados en extremos y ligero aumento de dispersi√≥n en regiones intermedias (Latinoam√©rica, Europa del Este).",
    "En 2020, Recaudaci√≥n sigue siendo alta y consistente en Europa Occidental/Norteam√©rica; baja y heterog√©nea en √Åfrica Subsahariana/Asia Central-Sur; intermedia en Latinoam√©rica y ligeramente bajo vs 2019.\nAhorro elevado en Asia del Este/Pac√≠fico y Europa Occidental; bajo en √Åfrica Subsahariana; variabilidad en Europa del Este y Latinoam√©rica.\nComparando con 2019 hay un ligero aumento de heterogeneidad en 2020 en grupos intermedios para ahorros, sin cambios en el orden relativo, y es un poco m√°s homog√©neo en recaudaci√≥n de impuestos. Versus el patr√≥n sin temporalidad, no hay cambios mayores.",
    "Exportaciones/Importaciones con medianas altas en Europa Occidental/Norteam√©rica/Asia del Este-Pac√≠fico; bajas en √Åfrica Subsahariana/Asia Central-Sur. Latinoam√©rica y Europa del Este con dispersi√≥n notable (brechas intra-regionales).\nvs 2019: el patr√≥n es similar; 2020 muestra algo m√°s de heterogeneidad en regiones mixtas, pero medianas bajas vs 2019, acentuando el efecto de pandemia. vs patrones sin temporalidad: Misma jerarqu√≠a; el global presenta dispersi√≥n m√°s moderada; 2020 acent√∫a diferencias dentro de regiones intermedias.",
    "En el 2020, las remsesas siguen siendo muy altas y muy dispersas en Asia Central/Sur y Latinoam√©rica; bajas o casi nulas en Europa Occidental/Norteam√©rica/Asia del Este-Pac√≠fico. Distribuciones con colas superiores dominadas por pocos pa√≠ses.\nvs 2019 y patr√≥n sin temporalidad, el 2020 hace m√°s visibles los m√°ximos y colas en la distribuci√≥n de las remesas a nivel regional.",
    "Gasto total alto en Norteam√©rica/Europa Occidental; bajo en √Åfrica Subsahariana; intermedio en Latinoam√©rica/Europa del Este.\nGasto militar: Oriente Medio con outliers muy elevados; Norteam√©rica alto pero m√°s estable; las dem√°s regiones moderado-bajo. esto indica la influencia de la pandemia, en el que los gastos fueron llevados m√°s a controlar la epidemia y a la salud de las personas, inviertiendo menos en otros rubreos como el militar."
  )
)

# Generamos la tabla con kableExtra
kable(
  analisis_2020,
  format = "html",
  align = "l",
  caption = "An√°lisis de Patrones Regionales - A√±o 2019",
  col.names = c("Categor√≠a", "Patrones Destacados")   # üëà ESTA ES LA L√çNEA NUEVA
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )

```

##### **A√±o 2021**
```{r multivariado_2021, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(A√±o == "2021") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gr√°fico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold")  # centrado + negrilla
  ) +
  labs(title = "Distribuci√≥n de las variables num√©ricas por regi√≥n para el a√±o 2021")
boxplots
```

El 2021 presenta una leve recuperaci√≥n comparando con el 2020, debido a la "normalidad" pos-COVID19. A continuaci√≥n, se presentan los siguientes hallazgos:
```{r analisis_multivariado_2021, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")
analisis_2021 = data.frame(
  Categoria = c(
    "Estructura Productiva (Agricultura/Producci√≥n/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "En el 2021 se mantiene la jerarqu√≠a: Europa Occidental y Norteam√©rica con Producci√≥n/Servicios altos y compactos y Agricultura baja; √Åfrica Subsahariana y Asia Central/Sur con Agricultura alta y dispersa y Producci√≥n/Servicios bajos; Asia del Este/Pac√≠fico en niveles altos/intermedios con menor dispersi√≥n.\nComparando con el 2020: Se recuperan ligeramente las medianas de Producci√≥n/Servicios en regiones avanzadas (leve repunte respecto al bache de 2020); Agricultura sin cambios sustantivos de posici√≥n. vs patr√≥n sin temporalidad: coincide la ordenaci√≥n estructural; el general suaviza picos/colas; 2021 enfatiza extremos puntuales.",
    "Recaudaci√≥n alta y estable en Europa Occidental/Norteam√©rica; baja y heterog√©nea en √Åfrica Subsahariana/Asia Central-Sur; Latinoam√©rica intermedia. Ahorro elevado en Asia del Este/Pac√≠fico y Europa Occidental; bajo en √Åfrica Subsahariana; variabilidad visible en Europa del Este y LatAm.\nvs 2020: se recupera levementa la Recaudaci√≥n y Ahorro en regiones avanzadas, aunque en regiones emergentes persiste heterogeneidad. vs patrones sin temporalidad: se exhibe menor variabilidad interna.",
    "Para el a√±o 2021, las Exportaciones/Importaciones mantienen medianas altas en Europa Occidental/Norteam√©rica/Asia del Este-Pac√≠fico; bajas en √Åfrica Subsahariana/Asia Central-Sur; LatAm y Europa del Este con dispersi√≥n notable, por la mezcla de econom√≠as muy abiertas y menos abiertas.\nvs 2020: se observa un incremento en medianas (reapertura y normalizaci√≥n del comercio) en regiones avanzadas y parte de Asia del Este/Pac√≠fico; regiones rezagadas permanecen por debajo. vs patr√≥n sin temporalidad: 2021 muestra brechas intra-regionales m√°s visibles en regiones mixtas.",
    "En el 2021, las remesas se mantienen muy altas y dispersas en Asia Central/Sur y Latinoam√©rica; bajas o casi nulas en Europa Occidental/Norteam√©rica/Asia del Este-Pac√≠fico. Se mantienen colas superiores por pocos pa√≠ses.\nvs 2020: Igual o ligeramente mayor en las regiones l√≠deres (las medianas se ven tan altas o un poco m√°s); regiones avanzadas siguen bajas. vs patrones sin temporalidad: El global amortigua extremos; 2021 hace m√°s visibles picos concentrados.",
    "Gasto total sin cambio en sus patrones: alto en Europa Occidental/Norteam√©rica; bajo en √Åfrica Subsahariana; intermedio en LatAm/Europa del Este. Gasto militar: Oriente Medio conserva outliers muy elevados; Norteam√©rica alto pero m√°s estable; el resto moderado/bajo.\nvs 2020: Niveles similares o ligeramente superiores en Gasto total en avanzadas (contin√∫a la senda de normalizaci√≥n); Gasto militar mantiene picos en Oriente Medio sin cambios de orden. vs Global: Mismo patr√≥n; el global suaviza outliers, mientras 2021 resalta m√°ximos."
  )
)

# Generamos la tabla con kableExtra
kable(
  analisis_2021,
  format = "html",
  align = "l",
  caption = "An√°lisis de Patrones Regionales - A√±o 2019",
  col.names = c("Categor√≠a", "Patrones Destacados")   # üëà ESTA ES LA L√çNEA NUEVA
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )

```

##### **A√±o 2022**
```{r multivariado_2022, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(A√±o == "2022") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gr√°fico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold")  # centrado + negrilla
  ) +
  labs(title = "Distribuci√≥n de las variables num√©ricas por regi√≥n para el a√±o 2022")
boxplots
```

El a√±o 2022 sigue en recuperaci√≥n luego de la pandemia del 2020, por ende, la mayor√≠a de los indicadores tienden a aumentar. a continuaci√≥n, se repsentan los hallazgos para este a√±o:
```{r analisis_multivariado_2022, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")
analisis_2022 = data.frame(
  Categoria = c(
    "Estructura Productiva (Agricultura/Producci√≥n/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "Agricultura: 2022 mantiene medianas altas en √Åfrica Subsahariana y Asia Central/Sur (sin cambios relevantes vs 2019‚Äì2021) y bajas en Europa Occidental/Norteam√©rica.\nProducci√≥n: 2022 muestra medianas ligeramente superiores a 2021 en Europa Occidental/Norteam√©rica (consolidaci√≥n tras 2020) y altas estables en Asia del Este/Pac√≠fico; bajas estables en √Åfrica Subsahariana/Asia Central-Sur.\nServicios: 2022 con medianas iguales o algo mayores que 2021 en Europa Occidental; Norteam√©rica se mantiene alta; LatAm intermedia con dispersi√≥n; √Åfrica Subsahariana baja.",
    "Recaudaci√≥n: 2022 con medianas levemente por encima de 2021 en Europa Occidental; Norteam√©rica estable-alta; √Åfrica Subsahariana baja estable; LatAm intermedia estable.\nAhorro: 2022 alto y estable en Asia del Este/Pac√≠fico; Europa Occidental ligero incremento vs 2021; √Åfrica Subsahariana baja; Europa del Este con variabilidad.\nVs 2019‚Äì2021: no hay cambios de jerarqu√≠a; se observan ajustes menores al alza en econom√≠as avanzadas.",
    "Para el a√±o 2022, las Exportaciones/Importaciones presentan medianas m√°s altas que 2021 en Europa Occidental/Norteam√©rica y ligero aumento en Asia del Este/Pac√≠fico (normalizaci√≥n pos-pandemia); LatAm y Europa del Este mantienen medianas intermedias con amplia dispersi√≥n; √Åfrica Subsahariana/Asia Central-Sur bajas estables. Vs 2020: 2022 se ubica claramente por encima (continuaci√≥n de la recuperaci√≥n). Vs 2019: 2022 aparece similar o levemente superior en econom√≠s avanzadas; similar en econom√≠as rezagadas. ",
    "El a√±o 2022 mantiene medianas altas en Asia Central/Sur y LatAm, similares o marginalmente superiores a 2021; Europa Occidental/Norteam√©rica/Asia del Este-Pac√≠fico permanecen bajas.",
    "Gasto total: a√±o 2022 alto y estable en Europa Occidental/Norteam√©rica (medianas igualwa o ligeramente superiores vs 2021), bajo en √Åfrica Subsahariana, intermedio en LatAm/Europa del Este.\nGasto militar: 2022 sin cambios de mediana relevantes a simple vista; Oriente Medio conserva valores altos con outliers; Norteam√©rica alto y estable; resto moderado-bajo."
  )
)

# Generamos la tabla con kableExtra
kable(
  analisis_2022,
  format = "html",
  align = "l",
  caption = "An√°lisis de Patrones Regionales - A√±o 2019",
  col.names = c("Categor√≠a", "Patrones Destacados")   # üëà ESTA ES LA L√çNEA NUEVA
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )

```

##### **A√±o 2023**
```{r multivariado_2023, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(A√±o == "2023") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gr√°fico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold")  # centrado + negrilla
  ) +
  labs(title = "Distribuci√≥n de las variables num√©ricas por regi√≥n para el a√±o 2023")
boxplots
```

El a√±o 2023 presenta una recuperaci√≥n consolidad luego de la pandemia del COVID-19, y persisten brechas en algunas regiones como √Åfrica Subsahariana y Asia Central/Sur.

```{r analisis_multivariado_2023, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")
analisis_2023 = data.frame(
  Categoria = c(
    "Estructura Productiva (Agricultura/Producci√≥n/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "Agricultura: 2023 mantiene consistencia en √Åfrica Subsahariana y Asia Central/Sur, sin cambios relevantes vs 2022; dispersi√≥n ligeramente menor (menos outliers).\nProducci√≥n: medianas levemente altas en Europa Occidental y Norteam√©rica (recuperaci√≥n consolidada),pero similar en Asia del Este/Pac√≠fico vs el a√±o anterior; regiones rezagadas sin mejora visible.\nServicios: medianas levemente altas en Europa Occidental y Norteam√©rica vs 2022; LatAm estable; √Åfrica Subsahariana sigue baja.\nPatr√≥n nuevo: ligera reducci√≥n de dispersi√≥n en regiones avanzadas (cajas m√°s compactas).",
    "Recaudaci√≥n: medianas con aumento leve en Europa Occidental y Norteam√©rica vs 2022; LatAm estable; √Åfrica Subsahariana sigue baja.\nAhorro: medianas altas en Asia del Este/Pac√≠fico y Europa Occidental (m√°ximos del periodo); LatAm y √Åfrica Subsahariana sin cambios.\nPatr√≥n nuevo: Asia del Este/Pac√≠fico consolida liderazgo en ahorro con menor dispersi√≥n.",
    "Exportaciones: medianas altas en Europa Occidental y Norteam√©rica (superan niveles 2022 y se acercan a 2019); LatAm y Europa del Este con dispersi√≥n alta; √Åfrica Subsahariana estable.\nImportaciones: patr√≥n similar; medianas ‚Üë en avanzadas, ‚âà en rezagadas.\nPatr√≥n nuevo: 2023 marca m√°ximos post-2020 en comercio para regiones avanzadas.",
    "Medianas similares en Asia Central/Sur y LatAm (altas); ligero aumento en LatAm vs 2022; regiones avanzadas siguen bajas. Dispersi√≥n alta persiste (colas superiores). Se mantiene concentraci√≥n en pocas econom√≠as.",
    "Gasto total: medianas levemente superiores en Europa Occidental y Norteam√©rica (m√°ximos del periodo); LatAm estable; √Åfrica Subsahariana baja.\nGasto militar: sin cambios sustantivos; Oriente Medio sigue con outliers altos, especialmente por la guErra Israel-Palestina.\nPatr√≥n nuevo: consolidaci√≥n de gasto p√∫blico alto en econom√≠as avanzadas."
  )
)

# Generamos la tabla con kableExtra
kable(
  analisis_2023,
  format = "html",
  align = "l",
  caption = "An√°lisis de Patrones Regionales - A√±o 2019",
  col.names = c("Categor√≠a", "Patrones Destacados")   # üëà ESTA ES LA L√çNEA NUEVA
) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )

```

##### **Correlaci√≥n**
```{r correlacion, fig.width=10, fig.height=10, fig.align='center', echo=FALSE}
df_sel = df_clean %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares
    )
                
# Calcula la matriz de correlaci√≥n
corr_matrix = round(cor(df_sel), 2)

ggcorrplot(corr_matrix,
  lab = TRUE,             # Muestra los coeficientes de correlaci√≥n en el gr√°fico
  type = "lower",         # Muestra solo la matriz triangular inferior
  outline.col = "white",  # Color del borde de los cuadrados
  ggtheme = ggplot2::theme_gray, # Tema de ggplot
  colors = c("#6D9EC1", "white", "#E46726") # Colores para correlaciones negativas, cero y positivas
) +
labs(title = "Matriz de Correlaci√≥n") +
theme(
  plot.title = element_text(hjust = 0.5, face = "bold", size = 14)
)
```

En cuanto a las asociaciones entre variables presentan lo siguiente:

- **Comercio exterior:** Exportaciones ‚Üî Importaciones muestran una correlaci√≥n alta (‚âà 0.81), lo que se puede deducir en que act√∫an como un mismo factor de apertura comercial; pa√≠ses que exportan m√°s, tambi√©n importan m√°s.
- **Flujos de capital internacional:** Inversi√≥n Extranjera ‚Äì Entrada ‚Üî Salida presentan una correlaci√≥n casi perfecta (‚âà 0.93), reflejando un mismo perfil financiero; econom√≠as que reciben capital tambi√©n invierten fuera (profundidad/sofisticaci√≥n financiera).
- **Estructura productiva moderna:** Producci√≥n y Servicios se correlacionan positivamente (alta‚Äìmoderada), adem√°s de que Recaudaci√≥n de impuestos y Ahorro tambi√©n tienden a correlacionar positivamente con Producci√≥n y Servicios. Lo anterior puede conducir a que hay un n√∫cleo de desarrollo interno (mayor producci√≥n y terciarizaci√≥n) asociado a mejor base fiscal y mayor ahorro.
- **Agricultura inverso a producci√≥n y servicios:** mayor peso agr√≠cola se asocia con menor capacidad fiscal y menor terciarizaci√≥n, actuando como indicador inverso de modernizaci√≥n.
- **Remesas:** tiene correlaciones bajas con la mayor√≠a de variables, por lo que estas pueden capturar una din√°mica espec√≠fica (migraci√≥n/ingreso externo de hogares) poco alineada con los ejes de comercio, capital y estructura productiva.

## **2. An√°lisis factorial m√∫ltiple**
```{r modelo, echo=FALSE, warning=FALSE}
BaseDUAL = df_clean %>%
  dplyr::select(
    Region,
    A√±o,
    Agricultura,
    Gastos,
    Produccion,
    Exportaciones,
    Importaciones,
    Remesas,
    Servicios,
    Recaudacion_Impuestos,
    Inversion_Extranjera_Entrada,
    Inversion_Extranjera_Salida,
    Ahorro,
    Gastos_Militares
  )

# Aplicar an√°lisis multifactorial
res.dmfa = DMFA(
  BaseDUAL,
  num.fact = 2,
  quali.sup = 1,
  graph = FALSE
)
```

### **Varianza explicada y contribuciones de las variables por dimensi√≥n**

A continuaci√≥n se muestran las dimensiones junto a sus porcentajes de cada variable:
```{r eigenvalues, echo=FALSE, warning=FALSE, fig.align='center'}
eig = as.data.frame(res.dmfa$eig)
eig$Dim = seq_len(nrow(eig))
eig$Dim = factor(paste0("Dim ", eig$Dim),
                 levels = paste0("Dim ", eig$Dim))

# Calcular varianza acumulada
eig$acumulada <- cumsum(eig$`percentage of variance`)

ggplot(eig, aes(x = Dim)) +
  # Barras de porcentaje explicado
  geom_col(aes(y = `percentage of variance`), fill = "#2C7FB8", width = 0.7) +
  # Etiquetas sobre las barras
  geom_text(aes(y = `percentage of variance`, 
                label = paste0(round(`percentage of variance`, 1), "%")),
            vjust = -0.5, size = 3.3) +
  # L√≠nea de varianza acumulada
  geom_line(aes(y = acumulada, group = 1), color = "red", size = 1) +
  geom_point(aes(y = acumulada), color = "red", size = 2) +
  geom_text(aes(y = acumulada, 
                label = paste0(round(acumulada, 1), "%")), 
            vjust = -1, color = "red", size = 3.2) +
  # Escala y ejes
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  labs(
    title = "Porcentaje de varianza explicada y acumulada",
    x = "Dimensi√≥n",
    y = "Porcentaje"
  ) +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```

```{r contribuciones, fig.width=8, echo=FALSE, warning=FALSE, dpi=150, fig.align='center'}
# Contribuci√≥n
coords = as.data.frame(res.dmfa$var$coord)
dims_plot = names(coords)
coords$Variable = rownames(coords)

coord_long = coords %>%
  pivot_longer(cols = dims_plot, names_to = "Dim", values_to = "Carga") %>%
  mutate(Signo = if_else(Carga >= 0, "Positivo", "Negativo"))

ggplot(coord_long, aes(x = Carga, y = Variable, fill = Signo)) +
  geom_col(width = 0.8, alpha = 0.95) +
  facet_wrap(~ Dim, scales = "free_y") +
  scale_fill_manual(values = c("Positivo" = "#2E8B57", "Negativo" = "#D73027")) + # verde/rojo
  labs(
    title = "Cargas por variable y dimensi√≥n",
    x = "Carga (coordenada en la dimensi√≥n)",
    y = "Variable",
    fill = ""
  ) +
  theme_light() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, face = "bold") # centrado y en negrilla
  )
```

```{r analisis_contribuciones, fig.width=8, echo=FALSE, warning=FALSE, dpi=150, fig.align='center'}
# Creaci√≥n del data frame con los hallazgos e interpretaci√≥n de las cuatro dimensiones principales.
#-----------------------------------------------
analisis_dmfa_extendido = data.frame(
  Componente = c(
    "Dimensi√≥n 1",
    "Dimensi√≥n 2",
    "Dimensi√≥n 3",
    "Dimensi√≥n 4"
  ),
  Hallazgos_Clave = c(
    "Correlaci√≥n POSITIVA fuerte con: Servicios, Recaudaci√≥n_Impuestos, Gastos, Exportaciones, Importaciones.\nCorrelaci√≥n NEGATIVA fuerte con: Agricultura.\n\nConclusi√≥n: Contrasta **econom√≠as avanzadas** (Servicios/Fiscalidad alta) vs. **econom√≠as primarias** (Agricultura).",
    "Correlaci√≥n POSITIVA fuerte con: Inversi√≥n Extranjera (Entrada/Salida).\n\nConclusi√≥n: Captura el **dinamismo de los flujos de capital internacional**, diferenciando econom√≠as seg√∫n su rol como receptoras/emisoras de inversi√≥n.",
    "Correlaci√≥n POSITIVA fuerte con: Ahorro y Producci√≥n.\nCorrelaci√≥n NEGATIVA moderada con: Servicios.\n\nConclusi√≥n: Relacionado con la **disciplina fiscal** y la capacidad de generar riqueza interna v√≠a ahorro y producci√≥n.",
    "Correlaci√≥n POSITIVA fuerte con: Remesas.\nCorrelaci√≥n NEGATIVA fuerte con: Gastos Militares.\n\nConclusi√≥n: Captura factores de **ingreso social externo** (Remesas) frente a **prioridades de seguridad/estrat√©gicas** (Gasto Militar)."
  ),
  Nombre_Propuesto = c(
    "Eje de Desarrollo y Modernizaci√≥n Econ√≥mica",
    "Eje de Flujos de Capital Internacional",
    "Eje de Ahorro Interno y Producci√≥n",
    "Eje de Vulnerabilidad Externa (Remesas vs. Seguridad)"
  ),
  Significado_Implicacion = c(
    "Define el nivel de modernizaci√≥n y riqueza. Separa las econom√≠as avanzadas (Servicios, alta base fiscal y comercial) de las econom√≠as primarias (Agricultura). Es el eje de posicionamiento estructural.",
    # Lo que estaba en Dim 3
    "Captura la capacidad de una econom√≠a para participar en el flujo bidireccional de la Inversi√≥n Extranjera Directa (FDI). Indica sofisticaci√≥n financiera y apertura a los mercados de capitales.",
    # Lo que estaba en Dim 2
    "Indica pa√≠ses con capacidad de generar riqueza interna v√≠a ahorro y producci√≥n.",
    "Separa pa√≠ses con alta prioridad en Gasto Militar (Riesgo Geopol√≠tico) de aquellos con alta dependencia de Remesas (Vulnerabilidad Socio-Financiera). Es un eje de flujos estrat√©gicos/sociales."
  ),
  Varianza_Explicada = c(
    "Aprox. 24.2% (Eje principal)",
    "Aprox. 15.6% (Segundo eje)",
    "Aprox. 12.7%",
    "Aprox. 10.1%"
  )
)

#----------------------------------------------------------------
# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_dmfa_extendido,
      format = "html",
      align = "l",
      col.names = c("Dimensi√≥n", "Hallazgos Clave", "Nombre Propuesto", "Significado e Implicaci√≥n", "Varianza Explicada"),
      caption = "Interpretaci√≥n Detallada de los Factores Latentes del DMFA") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Ajuste el ancho para que el texto de las implicaciones se vea mejor
  kableExtra::column_spec(2, width = "25em") %>%
  kableExtra::column_spec(4, width = "35em")
```

En total, las cuatro dimensiones seleccionadas explican el aproximandamente el **62.7% del total**.

### **An√°lisis por individuo (pa√≠ses)**
```{r analisis_paises, echo=FALSE, warning=FALSE, fig.align='center'}
# Muestra a los individuos (pa√≠ses) en el plano factorial.
plot.DMFA(res.dmfa, choix="ind",invisible="quali", label="none", new.plot=TRUE)
```

```{r analisis_hallazgos_paises, echo=FALSE, warning=FALSE, fig.align='center'}
# Creaci√≥n del data frame con el an√°lisis de los cuadrantes y patrones regionales.
analisis_cuadrantes = data.frame(
  Cuadrante = c(
    "Superior Izquierdo",
    "Superior Derecho",
    "Inferior Derecho",
    "Inferior Izquierdo"
  ),
  Posicion_Dim1 = c(
    "Baja (Negativa)",
    "Alta (Positiva)",
    "Alta (Positiva)",
    "Baja (Negativa)"
  ),
  Posicion_Dim2 = c(
    "Alta (Positiva)",
    "Alta (Positiva)",
    "Baja (Negativa)",
    "Baja (Negativa)"
  ),
  Regiones_T√≠picas = c(
    "√Åfrica Subsahariana, Latinoam√©rica (Parcial), Asia Central/Sur",
    "Oriente Medio y Norte de √Åfrica (Parcial), Europa del Este (Espec√≠fico)",
    "Europa Occidental, Norteam√©rica, Asia del Este/Pac√≠fico",
    "Econom√≠as primarias sin dependencia de remesas significativas"
  ),
  # Texto sin formato de negrita (sin **)
  Significado_del_Patr√≥n = c(
    "Vulnerabilidad Estructural: Bajo desarrollo (alta Agricultura) y fuerte dependencia de Remesas. Sus trayectorias muestran la lucha por salir del atraso estructural.",
    "Riesgo Estrat√©gico: Pa√≠ses con alto desarrollo o recursos que priorizan el Gasto Militar y/o experimentan fuertes flujos externos (Remesas o Inversi√≥n Vol√°til).",
    "Modernizaci√≥n y Estabilidad (Liderazgo Global): El polo de m√°ximo desarrollo (Servicios, Comercio, Fiscalidad) con baja dependencia de Remesas/Riesgo. Trayectorias cortas y estables (baja dispersi√≥n).",
    "Aislamiento/Estructura Simple: Bajo desarrollo (Agricultura alta) sin las influencias externas de Remesas o de Gasto Militar. Es el grupo menos poblado y de menor influencia global."
  )
)

# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_cuadrantes,
      format = "html",
      align = "l",
      col.names = c("Cuadrante", "Posici√≥n Dim. 1 (Desarrollo)", "Posici√≥n Dim. 2 (Vulnerabilidad)", "Regiones T√≠picas", "Significado del Patr√≥n (Cluster Econ√≥mico)"),
      caption = "An√°lisis de Agrupamiento por Cuadrantes en el Plano Factorial (Dim. 1 vs. Dim. 2)") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Ajuste el ancho para que el texto se vea mejor
  kableExtra::column_spec(5, width = "35em")
```

### **An√°lisis por a√±o**
```{r analisis_2019, echo=FALSE, warning=FALSE, fig.align='center'}
group_vars1 = as.data.frame(res.dmfa$var.partiel$Gr2019)
group_vars1$Variable = rownames(group_vars1)
group_vars1$A√±o = "2019"

group_vars2 = as.data.frame(res.dmfa$var.partiel$Gr2020)
group_vars2$Variable = rownames(group_vars2)
group_vars2$A√±o = "2020"

group_vars3 = as.data.frame(res.dmfa$var.partiel$Gr2021)
group_vars3$Variable = rownames(group_vars3)
group_vars3$A√±o = "2021"

group_vars4 = as.data.frame(res.dmfa$var.partiel$Gr2022)
group_vars4$Variable = rownames(group_vars4)
group_vars4$A√±o = "2022"

group_vars5 = as.data.frame(res.dmfa$var.partiel$Gr2023)
group_vars5$Variable = rownames(group_vars5)
group_vars5$A√±o = "2023"

lista_dfs = list(group_vars1, group_vars2, group_vars3, group_vars4, group_vars5)
group_vars = bind_rows(lista_dfs)

# Funci√≥n para generar puntos de una circunferencia
circle = function(radio, n = 100) {
  theta <- seq(0, 2*pi, length.out = n)
  data.frame(
    x = radio * cos(theta),
    y = radio * sin(theta),
    r = radio
  )
}

# Crear circunferencias con radios desde 0.2 hasta 1.2
radios = seq(0.2, 1.0, by = 0.2)
circunferencias = do.call(rbind, lapply(radios, circle))

group_vars_filt = group_vars %>%
  filter(A√±o == "2019")

ggplot(group_vars_filt, aes(x = Dim.1, y = Dim.2, color = Variable)) +
  geom_point(size = 3) +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), 
            color = "gray85", inherit.aes = FALSE) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por a√±o 2019",
       color = "Variables") +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(hjust = 0.5, face = "bold")  # Centrado y en negrilla
  )

```

```{r hallazgos_2019, echo=FALSE, warning=FALSE, fig.align='center'}
# Creaci√≥n del data frame con el an√°lisis de las variables en 2019.
analisis_vars_2019 = data.frame(
  Eje_Patron = c(
    "Dimensi√≥n 1: Polo Positivo",
    "Dimensi√≥n 1: Polo Negativo",
    "Dimensi√≥n 2: Polo Positivo (Riesgo/Estrategia)",
    "Flujos de Capital (Inversiones)"
  ),
  Variables_Clave = c(
    "Servicios, Recaudacion_Impuestos, Importaciones, Exportaciones, Produccion, Gastos, Ahorro",
    "Agricultura",
    "Gastos_Militares, Remesas",
    "Inversion_Extranjera_Entrada, Inversion_Extranjera_Salida"
  ),
  Proyeccion_Fuerza = c(
    "Correlaci√≥n muy fuerte (cerca del radio 1.0)",
    "Correlaci√≥n muy fuerte (cerca del radio -1.0)",
    "Positivas, con posiciones divergentes en Dim. 1",
    "Correlaci√≥n alta en Dim. 1, baja en Dim. 2"
  ),
  Hallazgo_Clave = c(
    "La principal diferenciaci√≥n econ√≥mica en 2019 era la Sofisticaci√≥n: alto peso de servicios y comercio, y una base fiscal s√≥lida.",
    "Confirma la dicotom√≠a Desarrollo vs. Primario, al oponerse directamente a todas las variables de modernizaci√≥n en Dim. 1.",
    "El Riesgo Estrat√©gico (Gasto Militar, Cuadrante Superior Derecho) y la Dependencia Social (Remesas, Cuadrante Superior Izquierdo) son los principales factores laterales de diferenciaci√≥n.",
    "Los flujos de inversi√≥n extranjera se reg√≠an principalmente por el tama√±o y la sofisticaci√≥n del mercado (correlaci√≥n con Dim. 1), y no eran el principal motor de la vulnerabilidad (Dim. 2)."
  )
)

# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_vars_2019,
      format = "html",
      align = "l",
      col.names = c("Eje/Patr√≥n", "Variables Clave", "Proyecci√≥n (Fuerza de Carga)", "Hallazgo Clave (Contexto 2019)"),
      caption = "An√°lisis de Correlaciones de Variables en el Plano Factorial (Dim. 1 vs. Dim. 2) - A√±o 2019") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Ajuste el ancho para que el texto se vea mejor
  kableExtra::column_spec(4, width = "35em")
```

```{r analisis_2020, echo=FALSE, warning=FALSE, fig.align='center'}
group_vars_filt = group_vars %>%
  filter(A√±o == "2020")

ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2, color = Variable)) +
  geom_point(size = 3) +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), 
            color = "gray85", inherit.aes = FALSE) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
    labs(title = "Biplot entre Dimensiones 1 y 2 por a√±o 2020",
       color = "Variables") +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(hjust = 0.5, face = "bold")  # Centrado y en negrilla
  )
```

```{r hallazgos_2020, echo=FALSE, warning=FALSE, fig.align='center'}
# Creaci√≥n del data frame con el an√°lisis de las variables en 2020.
analisis_vars_2020 = data.frame(
  Eje_Patron = c(
    "Dimensi√≥n 1: Estabilidad Estructural",
    "Dimensi√≥n 2: Gasto y Crisis",
    "Flujos de Capital (Inversiones)",
    "Remesas (Resiliencia Social)"
  ),
  Variables_Clave = c(
    "Servicios, Produccion, Importaciones, Exportaciones, Agricultura",
    "Gastos",
    "Inversion_Extranjera_Entrada, Inversion_Extranjera_Salida",
    "Remesas"
  ),
  Cambio_vs_2019 = c(
    "Posici√≥n relativa sin cambios. Alta fuerza.",
    "Desplazamiento fuerte hacia Dim. 2 (arriba)",
    "Desplazamiento hacia el centro (origen)",
    "Mantiene fuerte carga positiva en Dim. 2"
  ),
  Hallazgo_Clave = c(
    "El factor fundamental de **Desarrollo vs. Primario** se mantiene inmutable a pesar del shock por la pandemia, confirmando la estabilidad de la estructura econ√≥mica base.",
    "El **Gasto P√∫blico** se disocia de su correlaci√≥n 'normal' con el desarrollo (Dim. 1) para alinearse con la gesti√≥n de la crisis, funcionando como una variable de **respuesta fiscal**.",
    "Ambas inversiones se vuelven **menos correlacionadas** con los ejes principales. Esto refleja la **paralizaci√≥n de los flujos** transfronterizos debido a la incertidumbre y el riesgo global.",
    "Las Remesas se confirman como una **fuente crucial de resiliencia** en pa√≠ses vulnerables. Su fuerza en Dim. 2 subraya la importancia de la di√°spora en la mitigaci√≥n del impacto de la crisis."
  )
)

# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_vars_2020,
      format = "html",
      align = "l",
      col.names = c("Eje/Patr√≥n", "Variables Clave", "Cambio vs. 2019", "Hallazgo Clave (Efecto de la Crisis en 2020)"),
      caption = "An√°lisis de Correlaciones de Variables en el Plano Factorial (Dim. 1 vs. Dim. 2) - A√±o 2020") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Ajuste el ancho para que el texto se vea mejor
  kableExtra::column_spec(4, width = "35em")
```

```{r analisis_2021, echo=FALSE, warning=FALSE, fig.align='center'}
group_vars_filt = group_vars %>%
  filter(A√±o == "2021")

ggplot(group_vars_filt, aes(x = Dim.1, y = Dim.2, color = Variable)) +
  geom_point(size = 3) +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), 
            color = "gray85", inherit.aes = FALSE) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por a√±o 2021",
       color = "Variables") +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(hjust = 0.5, face = "bold")  # Centrado y en negrilla
  )

```

```{r hallazgos_2021, echo=FALSE, warning=FALSE, fig.align='center'}
# Creaci√≥n del data frame con el an√°lisis de las variables en 2021.
analisis_vars_2021 = data.frame(
  Eje_Patron = c(
    "Dimensi√≥n 1: Desarrollo Estructural",
    "Pol√≠tica Fiscal (Gasto)",
    "Flujos de Capital (Inversiones)",
    "Vulnerabilidad Estructural (Remesas)"
  ),
  Variables_Clave = c(
    "Servicios, Produccion, Comercio, Fiscalidad, Ahorro, Agricultura",
    "Gastos",
    "Inversion_Extranjera_Entrada, Inversion_Extranjera_Salida",
    "Remesas"
  ),
  Cambio_vs_2020 = c(
    "Agrupamiento m√°s compacto y fuerte en Dim. 1.",
    "Regreso a la posici√≥n de 2019 (cerca de Dim. 1).",
    "Recuperaci√≥n de la fuerza, alej√°ndose del origen.",
    "Mantiene fuerte carga positiva en Dim. 2 (inmutable)."
  ),
  Hallazgo_Clave = c(
    "La recuperaci√≥n post-crisis reforz√≥ la correlaci√≥n entre variables de desarrollo. La diferenciaci√≥n principal sigue siendo la estructura (Servicios/Industrial vs. Agr√≠cola).",
    "El Gasto P√∫blico se desvincula de la gesti√≥n de la crisis (Dim. 2) y vuelve a correlacionarse con el tama√±o y la capacidad fiscal de la econom√≠a (Dim. 1).",
    "El retorno de la confianza global impulsa la recuperaci√≥n de los flujos de inversi√≥n, que vuelven a ser atra√≠dos por los mercados m√°s grandes y desarrollados (correlaci√≥n con Dim. 1).",
    "Se consolida como un rasgo estructural, no solo una reacci√≥n transitoria a la crisis. La Dim. 2 se mantiene como el eje que captura la dependencia de los ingresos externos de la di√°spora."
  )
)

# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_vars_2021,
      format = "html",
      align = "l",
      col.names = c("Eje/Patr√≥n", "Variables Clave", "Cambio vs. 2020 (Recuperaci√≥n)", "Hallazgo Clave (Contexto 2021)"),
      caption = "An√°lisis de Correlaciones de Variables en el Plano Factorial (Dim. 1 vs. Dim. 2) - A√±o 2021") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Ajuste el ancho para que el texto se vea mejor
  kableExtra::column_spec(4, width = "35em")
```

```{r analisis_2022, echo=FALSE, warning=FALSE, fig.align='center'}
group_vars_filt = group_vars %>%
  filter(A√±o == "2022")

ggplot(group_vars_filt, aes(x = Dim.1, y = Dim.2, color = Variable)) +
  geom_point(size = 3) +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), 
            color = "gray85", inherit.aes = FALSE) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por a√±o 2022",
       color = "Variables") +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(hjust = 0.5, face = "bold")  # Centrado y en negrilla
  )

```

```{r hallazgos_2022, echo=FALSE, warning=FALSE, fig.align='center'}
# Creaci√≥n del data frame con el an√°lisis de las variables en 2022.
analisis_vars_2022 = data.frame(
  Eje_Patron = c(
    "Dimensi√≥n 1: Estabilidad del Desarrollo",
    "Gasto P√∫blico (Normalizaci√≥n)",
    "Flujos de Capital (Recuperaci√≥n)",
    "Dimensi√≥n 2: Reforzamiento del Riesgo"
  ),
  Variables_Clave = c(
    "Servicios, Produccion, Comercio, Fiscalidad, Agricultura",
    "Gastos",
    "Inversion_Extranjera_Entrada, Inversion_Extranjera_Salida",
    "Gastos_Militares, Remesas"
  ),
  Cambio_vs_2020 = c(
    "Estructura inmutable (alta fuerza).",
    "Retorno a la correlaci√≥n con Dim. 1 (desplazamiento hacia abajo).",
    "Fuerza renovada y alejamiento del centro.",
    "Gastos Militares m√°s prominente. Remesas persistentes."
  ),
  Hallazgo_Clave = c(
    "El factor de diferenciaci√≥n principal sigue siendo la estructura. La brecha entre econom√≠as de servicios/industrial y primaria es estructuralmente resistente a los shocks.",
    "El Gasto vuelve a ser un indicador del tama√±o y la capacidad fiscal de la econom√≠a (Dim. 1), desvincul√°ndose de la pol√≠tica de respuesta de emergencia de la pandemia (Dim. 2).",
    "La confianza se recupera totalmente; los flujos de inversi√≥n vuelven a estar impulsados por el tama√±o y la estabilidad del mercado. Se recuperan los patrones pre-crisis.",
    "El Gasto Militar se solidifica como un factor clave de diferenciaci√≥n en el contexto de tensi√≥n geopol√≠tica (guerra en Ucrania). Las Remesas mantienen su rol como dependencia estructural."
  )
)

# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_vars_2022,
      format = "html",
      align = "l",
      col.names = c("Eje/Patr√≥n", "Variables Clave", "Cambio vs. 2021 (Post-Crisis)", "Hallazgo Clave (Contexto 2022)"),
      caption = "An√°lisis de Correlaciones de Variables en el Plano Factorial (Dim. 1 vs. Dim. 2) - A√±o 2022") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Ajuste el ancho para que el texto se vea mejor
  kableExtra::column_spec(4, width = "35em")
```

```{r analisis_2023, echo=FALSE, warning=FALSE, fig.align='center'}
group_vars_filt = group_vars %>%
  filter(A√±o == "2023")

ggplot(group_vars_filt, aes(x = Dim.1, y = Dim.2, color = Variable)) +
  geom_point(size = 3) +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), 
            color = "gray85", inherit.aes = FALSE) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por a√±o 2023",
       color = "Variables") +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(hjust = 0.5, face = "bold")  # Centrado y en negrilla
  )

```

```{r hallazgos_2023, echo=FALSE, warning=FALSE, fig.align='center'}
# Creaci√≥n del data frame con el an√°lisis de las variables en 2023.
analisis_vars_2023 = data.frame(
  Eje_Patron = c(
    "Dimensi√≥n 1: Desarrollo Consolidado",
    "Normalizaci√≥n de la Pol√≠tica y Finanzas",
    "Dimensi√≥n 2: Riesgo Geopol√≠tico (Persistente)",
    "Dimensi√≥n 2: Dependencia Social (Estructural)"
  ),
  Variables_Clave = c(
    "Servicios, Produccion, Comercio, Fiscalidad, Agricultura",
    "Gastos, Inversion_Extranjera_Entrada/Salida",
    "Gastos_Militares",
    "Remesas"
  ),
  Evolucion_Final = c(
    "M√°xima fuerza y compactaci√≥n en Dim. 1.",
    "Completamente reintegradas al cl√∫ster de Dim. 1.",
    "Mantiene una fuerte carga positiva en Dim. 2 (Reforzada vs. 2019).",
    "Mantiene una carga inmutable y fuerte en Dim. 2 (Superior Izquierdo)."
  ),
  Hallazgo_Clave = c(
    "El factor principal de diferenciaci√≥n es, de nuevo, la **estructura econ√≥mica b√°sica**. El sistema ha regresado a un estado donde la capacidad productiva define el desarrollo (Dim. 1).",
    "Las variables de Gasto e Inversi√≥n han dejado de ser indicadores de 'respuesta a la crisis' (Dim. 2) y ahora se rigen por la **capacidad y tama√±o de la econom√≠a** (Dim. 1).",
    "El Gasto Militar se solidifica como un factor **estructural de la nueva era geopol√≠tica**. Los pa√≠ses desarrollados se diferencian por el peso estrat√©gico de su defensa.",
    "Las Remesas se confirman como un **rasgo estructural, no transitorio**. La Dimensi√≥n 2 se convierte en el eje persistente que captura la vulnerabilidad y la dependencia de los ingresos de la di√°spora."
  )
)

# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_vars_2023,
      format = "html",
      align = "l",
      col.names = c("Eje/Patr√≥n", "Variables Clave", "Evoluci√≥n Final (2023)", "Hallazgo Clave (Nuevo Equilibrio)"),
      caption = "An√°lisis de Correlaciones de Variables en el Plano Factorial (Dim. 1 vs. Dim. 2) - A√±o 2023") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Ajuste el ancho para que el texto se vea mejor
  kableExtra::column_spec(4, width = "35em")
```

### **An√°lisis por regi√≥n**

```{r modelo_regiones_contr, echo=FALSE, warning=FALSE, fig.width=10, fig.height=8, fig.align='center'}
region_list = c(
    "√Åfrica - √Åfrica Subsahariana",
    "√Åfrica - Norte de √Åfrica",
    "Am√©rica - Latinoam√©rica y el Caribe",
    "Am√©rica - Norteam√©rica",
    "Asia - Asia Central y del Sur",
    "Asia - Oriente Medio",
    "Asia del Este, Pac√≠fico y Ocean√≠a",
    "Europa - Europa del Este",
    "Europa - Europa Occidental"
  )
regions = as.data.frame(res.dmfa$quali.sup$coord)
regions$Region = rownames(regions)

regions_filt = regions %>%
  filter(Region == region_list)

regions_filt = regions_filt %>%
  pivot_longer(cols = dims_plot, names_to = "Dim", values_to = "Carga") %>%
  mutate(Signo = if_else(Carga >= 0, "Positivo", "Negativo"))

ggplot(regions_filt, aes(x = Carga, y = Region, fill = Signo)) +
  geom_col(width = 0.8, alpha = 0.95) +
  facet_wrap(~ Dim, scales = "free_y") +
  scale_fill_manual(values = c("Positivo" = "#2E8B57", "Negativo" = "#D73027")) + # verde/rojo
  labs(
    title = "Cargas por regi√≥n y dimensi√≥n",
    x = "Carga (coordenada en la dimensi√≥n)",
    y = "Variable",
    fill = ""
  ) +
  theme_light() +
  theme(legend.position = "none")
```

```{r hallazgos_modelo_regiones_contr, echo=FALSE, warning=FALSE, fig.width=10, fig.height=8, fig.align='center'}
# Creaci√≥n del data frame con el an√°lisis de las coordenadas regionales.
analisis_regiones = data.frame(
  Regi√≥n = c(
    "Europa - Europa Occidental",
    "Am√©rica - Norteam√©rica",
    "Asia del Este, Pac√≠fico y Ocean√≠a",
    "Am√©rica - Latinoam√©rica y el Caribe",
    "√Åfrica Subsahariana / Asia Central y del Sur",
    "Asia - Oriente Medio / √Åfrica - Norte de √Åfrica",
    "Europa - Europa del Este" # Asumiendo una posici√≥n en el gr√°fico
  ),
  Dim_1_Desarrollo = c(
    "Muy Positiva (Extremo Derecha)",
    "Muy Positiva (Extremo Derecha)",
    "Positiva",
    "Cercana a Cero/Levemente Negativa",
    "Muy Negativa (Extremo Izquierda)",
    "Intermedia / Baja",
    "Intermedia / Baja"
  ),
  Dim_2_Vulnerabilidad = c(
    "Negativa o Baja",
    "Negativa o Baja",
    "Negativa o Baja",
    "Muy Positiva",
    "Positiva",
    "Positiva",
    "Positiva o Cero"
  ),
  Implicacion_Estructural = c(
    "Polo de **m√°xima sofisticaci√≥n** (Servicios, Comercio, Fiscalidad). Baja dependencia de factores de riesgo Dim. 2.",
    "Similar a Europa, consolidando el cl√∫ster de **econom√≠as avanzadas y estables** en el tiempo.",
    "Fuerte desarrollo (Dim. 1) combinado con **alta autonom√≠a financiera** (Dim. 2 Negativa), indicando un modelo de crecimiento estable.",
    "Posici√≥n de **dependencia social m√°s alta**. Su econom√≠a mixta se distingue estructuralmente por el rol clave de las **Remesas**.",
    "Polo de **econom√≠as primarias** (alta Agricultura). La Dim. 2 confirma su **vulnerabilidad estructural** y dependencia de Remesas.",
    "La Dim. 2 se debe a la influencia de **Gastos Militares** y Remesas. Su Dim. 1 intermedia refleja la heterogeneidad productiva.",
    "Regi√≥n de **transici√≥n**; desarrollo intermedio y vulnerabilidad variable, influenciada por su cercan√≠a a factores geopol√≠ticos (Gasto Militar)."
  )
)

# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_regiones,
      format = "html",
      align = "l",
      col.names = c("Regi√≥n", "Dim. 1 (Desarrollo)", "Dim. 2 (Vulnerabilidad/Riesgo)", "Implicaci√≥n Estructural y Hallazgo Clave"),
      caption = "Coordenadas de las Regiones en el Plano Factorial (Dim. 1 vs. Dim. 2) - DMFA") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Agrupaci√≥n de columnas por Dimensi√≥n para mejor lectura
  kableExtra::add_header_above(c(" " = 1, "Eje de Posici√≥n Estructural" = 2, " " = 1)) %>%
  kableExtra::column_spec(4, width = "35em")
```

***Conclusi√≥n Clave:***
El An√°lisis de la Proyecci√≥n de Regiones confirma la alta capacidad discriminatoria del DMFA:

- ***Segregaci√≥n Horizontal (Dim. 1):*** Existe una clara brecha de desarrollo que separa a las econom√≠as maduras y sofisticadas (Europa, Norteam√©rica) de las econom√≠as primarias (√Åfrica Subsahariana, Asia Central).

- ***Segregaci√≥n Vertical (Dim. 2):*** El eje de vulnerabilidad a√≠sla a las regiones con alta dependencia de flujos sociales (Remesas) (Latinoam√©rica, √Åfrica) de aquellas con autonom√≠a financiera (Asia del Este, Europa Occidental).

```{r analisis_region, echo=FALSE, warning=FALSE, fig.width=10, fig.height=8, fig.align='center'}
# Visualiza las modalidades de la variable cualitativa.
plot.DMFA(res.dmfa, choix="quali",invisible="quali", label="none")

```


***Hallazgos:***

***Hallazgos: Cl√∫ster de Desarrollo y Estabilidad (Inferior Derecho)***
```{r analisis_region_1, echo=FALSE, warning=FALSE, fig.width=10, fig.height=8, fig.align='center'}
# Creaci√≥n del data frame enfocado √∫nicamente en el Cl√∫ster de Desarrollo y Estabilidad
analisis_cluster_desarrollo = data.frame(
  Regi√≥n = c(
    "Europa - Europa Occidental",
    "Am√©rica - Norteam√©rica",
    "Asia del Este, Pac√≠fico y Ocean√≠a"
  ),
  Dim_1_Desarrollo = c(
    "Muy Positiva (Extremo Derecha)",
    "Muy Positiva (Extremo Derecha)",
    "Positiva Alta"
  ),
  Dim_2_Vulnerabilidad = c(
    "Negativa o Baja",
    "Negativa o Baja",
    "Negativa"
  ),
  Hallazgo_Estructural = c(
    "Representa el **Polo de m√°xima sofisticaci√≥n** (Servicios, Comercio, Fiscalidad). Su baja carga en Dim. 2 indica **autonom√≠a y estabilidad**.",
    "Centroide muy cercano a Europa Occidental, consolidando el perfil de **econom√≠a global l√≠der** y la mayor estabilidad estructural del mundo.",
    "Alto desarrollo (Dim. 1) combinado con la **mayor independencia financiera** (Dim. 2 Negativa m√°s marcada), sugiriendo un modelo de crecimiento basado en el **ahorro** y la autosuficiencia."
  )
)

# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_cluster_desarrollo,
      format = "html",
      align = "l",
      col.names = c("Regi√≥n", "Carga Dim. 1 (Desarrollo)", "Carga Dim. 2 (Vulnerabilidad)", "An√°lisis del Centroide (Tipolog√≠a Estructural)"),
      caption = "An√°lisis de los Centroides: Cl√∫ster de Desarrollo y Estabilidad (Dim. 1 Positiva, Dim. 2 Negativa)") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Agrupaci√≥n de columnas por Dimensi√≥n para mejor lectura
  kableExtra::add_header_above(c(" " = 1, "Posici√≥n en el Cuadrante Inferior Derecho" = 2, " " = 1)) %>%
  kableExtra::column_spec(4, width = "40em")
```

***Hallazgos: Cl√∫ster de Vulnerabilidad Estructural (Superior Izquierdo)***

```{r analisis_region_2, echo=FALSE, warning=FALSE, fig.width=10, fig.height=8, fig.align='center'}
# Creaci√≥n del data frame enfocado √∫nicamente en el Cl√∫ster de Vulnerabilidad Estructural
analisis_cluster_vulnerabilidad = data.frame(
  Regi√≥n = c(
    "√Åfrica Subsahariana / Asia Central y del Sur",
    "Am√©rica - Latinoam√©rica y el Caribe",
    "Asia - Oriente Medio / √Åfrica - Norte de √Åfrica"
  ),
  Dim_1_Desarrollo = c(
    "Muy Negativa (Extremo Izquierda)",
    "Cercana a Cero/Levemente Negativa",
    "Intermedia / Baja"
  ),
  Dim_2_Vulnerabilidad = c(
    "Positiva Alta",
    "Muy Positiva (Extremo Superior)",
    "Positiva"
  ),
  Hallazgo_Estructural = c(
    "Define el polo de **econom√≠as primarias**. Su alta carga en Dim. 2 confirma la **dependencia estructural de las Remesas** y la baja sofisticaci√≥n productiva.",
    "El centroide m√°s alto en Dim. 2. Su posici√≥n destaca el **rol dominante de las remesas** como el principal rasgo estructural, a pesar de tener una base productiva m√°s diversificada que √Åfrica.",
    "Su Dim. 2 est√° impulsada por el **Gasto Militar** (Riesgo Estrat√©gico) y Remesas. Su Dim. 1 heterog√©nea refleja la mezcla de pa√≠ses productores de recursos y en conflicto."
  )
)

# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_cluster_vulnerabilidad,
      format = "html",
      align = "l",
      col.names = c("Regi√≥n", "Carga Dim. 1 (Desarrollo)", "Carga Dim. 2 (Vulnerabilidad)", "An√°lisis del Centroide (Tipolog√≠a Estructural)"),
      caption = "An√°lisis de los Centroides: Cl√∫ster de Vulnerabilidad Estructural (Dim. 1 Negativa, Dim. 2 Positiva)") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Agrupaci√≥n de columnas por Dimensi√≥n para mejor lectura
  kableExtra::add_header_above(c(" " = 1, "Posici√≥n en el Cuadrante Superior Izquierdo" = 2, " " = 1)) %>%
  kableExtra::column_spec(4, width = "40em")
```

***Hallazgos: Cl√∫ster de Transici√≥n y Riesgo Estrat√©gico***

```{r analisis_region_3, echo=FALSE, warning=FALSE, fig.width=10, fig.height=8, fig.align='center'}
# Creaci√≥n del data frame enfocado √∫nicamente en el Cl√∫ster de Transici√≥n y Riesgo Estrat√©gico
analisis_cluster_transicion = data.frame(
  Regi√≥n = c(
    "Asia - Oriente Medio / √Åfrica - Norte de √Åfrica",
    "Europa - Europa del Este"
  ),
  Dim_1_Desarrollo = c(
    "Intermedia / Baja",
    "Intermedia / Baja (Cercana a Cero)"
  ),
  Dim_2_Vulnerabilidad = c(
    "Positiva",
    "Positiva o Cercana a Cero"
  ),
  Hallazgo_Estructural = c(
    "Su centroide est√° dominado por la **Dim. 2 (Gastos Militares y Remesas)**. La Dim. 1 intermedia refleja una **alta heterogeneidad** de pa√≠ses productores de recursos vs. pa√≠ses en conflicto.",
    "Regi√≥n **bisagra o de transici√≥n**. Muestra un desarrollo intermedio y una vulnerabilidad variable. Su posici√≥n es altamente sensible a los **factores geopol√≠ticos** de Europa (Dim. 2)."
  )
)

# Generaci√≥n de la tabla usando kable y kableExtra
knitr::kable(analisis_cluster_transicion,
      format = "html",
      align = "l",
      col.names = c("Regi√≥n", "Carga Dim. 1 (Desarrollo)", "Carga Dim. 2 (Vulnerabilidad)", "An√°lisis del Centroide (Tipolog√≠a Estructural)"),
      caption = "An√°lisis de los Centroides: Cl√∫ster de Transici√≥n y Riesgo Estrat√©gico") %>%
  kableExtra::kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = TRUE,
    position = "center"
  ) %>%
  # Agrupaci√≥n de columnas por Dimensi√≥n para mejor lectura
  kableExtra::add_header_above(c(" " = 1, "Posici√≥n Intermedia y Estrat√©gica" = 2, " " = 1)) %>%
  kableExtra::column_spec(4, width = "40em")
```

***Conclusi√≥n sobre la Segregaci√≥n Regional:***
La distribuci√≥n de los centroides valida el modelo DMFA: las regiones se segregan en el plano factorial de manera que reflejan tipolog√≠as econ√≥micas persistentes a lo largo del tiempo. Las distancias entre los centroides son significativas, lo que subraya la existencia de grandes brechas estructurales entre los bloques globales (e.g., la distancia entre Europa Occidental y √Åfrica Subsahariana).

## 3. Conclusiones
- La Dimensi√≥n 1 explica el contraste estructural entre econom√≠as avanzadas (altos niveles de servicios, comercio exterior y recaudaci√≥n fiscal) frente a econom√≠as primarias (dependientes de la agricultura).  
- La Dimensi√≥n 2 refleja la participaci√≥n en flujos de inversi√≥n extranjera (entrada y salida), diferenciando econom√≠as con mayor apertura financiera de aquellas m√°s cerradas.  
- Las Dimensiones 3 y 4 capturan din√°micas complementarias:  
  - Disciplina fiscal y ahorro nacional.  
  - Factores externos como remesas y gasto militar que influyen en la vulnerabilidad socioecon√≥mica.  
- Los pa√≠ses se agrupan de manera coherente con su nivel de desarrollo:  
  - Europa y Norteam√©rica se ubican en el eje de modernizaci√≥n econ√≥mica.  
  - Latinoam√©rica y otras regiones muestran mayor dependencia de remesas y flujos externos.  
- Se evidencia un patr√≥n de estabilidad en la estructura de los ejes a lo largo de los a√±os, lo que indica consistencia en las trayectorias de desarrollo econ√≥mico. Sin embargo, se puede ver como el a√±o 2020 hay cierta afectaci√≥n por la pandemia del COVID-19 y a medida que iba pasando, las econom√≠as en las diferentes regiones del planeta se fueron re-ajustando, llegando a patrones similares antes de pandemia o mejorando algunos rubros.
- El modelo DMFA logra sintetizar aproximadamente el 62-65% de la varianza total con las primeras cuatro dimensiones, lo cual es suficiente para un an√°lisis robusto de trayectorias.
- La pandemia del COVID-19 tuvo cierta afectaci√≥n en los p√°ises en general (a√±o 2020). Sin embargo, los resultados permiten evidenciar como las regiones fueron ajust√°ndose a sus patrones "normales" antes de pandemia, e inclusive mejorando cierto aspectos, a medida que se iban recuperando.
- En conjunto, el an√°lisis permite comparar pa√≠ses, regiones y periodos de tiempo, aportando una visi√≥n integral de la evoluci√≥n de los factores econ√≥micos latentes.  


