---
title: "Taller 4 - Modelo DUAL"
author:
  - name: "Jhon Fernando Tascon Velasco"
  - name: "Lino Alexander Sinisterra"
  - name: "Juan Sebastian Chacón"
date: "2025-09-29"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
library(readxl)
library(dplyr)
library(tidyverse)
library(plotly)
library(ggcorrplot)
library(ggplot2)
library(reshape2)
library(ResourceSelection)
library(knitr)
library(kableExtra)
library(FactoMineR)
library(scales)
library(zoo)
library(factoextra)
```

## **0. Información general**

En este trabajo se realizará un análisis factorial multiple con el fin de examinar trayectorias y agrupamientos de diferentes variables económicas, para identificar factores latentes, similitudes y diferencias a lo largo de los últimos cinco años (2019 al 2023), desagregado por regiones geográficas. Los datos están a nivel país, pero se realizó un procedimiento para agrupar los países en 14 regiones, con base en sus similitudes geográficas y étnicas. Las regiones son: Asia Central y del Sur, Oriente Medio, Asia del Este, Pacífico y Oceanía, Europa Occidental, Europa del Este, Norte de África, África Subsahariana, Latinoamérica y el Caribe y Norteamérica. 

Las variables a analizar son las siguientes:

```{r tabla_variables, echo=FALSE}
variables <- data.frame(
  Variables = c(
    "Pais",
    "Año",
    "Region",
    "Servicios",
    "Gastos",
    "Ahorro",
    "Exportaciones",
    "Importaciones",
    "Produccion",
    "Inversion_Extranjera_Entrada",
    "Inversion_Extranjera_Salida",
    "Deuda",
    "Recaudacion_Impuestos",
    "Agricultura",
    "Remesas",
    "Gastos_Militares"
  ),
  Tipo_Variable = c(
    "Nominal",
    "Ordinal",
    "Nominal",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa"
  ),
  Descripción = c(
    "País",
    "Año",
    "Región",
    "Servicios, valor agregado (% PIB)",
    "Gastos (% PIB)",
    "Ahorro bruto (% PIB)",
    "Exportaciones de bienes y sevicios (% PIB)",
    "Importaciones de bienes y servicios (% PIB)",
    "Producción, valor agregado (% PIB)",
    "Inversión extranjera, entrada neta de capital (% PIB)",
    "Inversión extranjera, salidad neta de capital (% PIB)",
    "Total Deuda (% PIB)",
    "Recaudación impostivia (% PIB)",
    "Agricultura, silvicultura y pesca, valor agregado (% PIB)",
    "Remesas de trabajdores y compensación de empleados recibidas (% PIB)",
    "Gastos militares (%PIB)"
  )
)

kable(variables, format = "html", caption = "Descripción de variables del estudio", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = FALSE, position = "center")
```

- ***Unidad de Estudio (Individuos):***	La unidad de observación principal es el País, cuyas características económicas varían en el tiempo.

- ***Horizonte Temporal:***	El estudio abarca un periodo de cinco años (2019 al 2023). Este marco es crítico, ya que incluye el impacto y la recuperación de la crisis global iniciada en 2020, lo que potencia el análisis de trayectorias.

- ***Variables Activas (Cuantitativas):***	Se emplearán 13 variables económicas (e.g., Servicios, Gastos, Deuda, Exportaciones, Remesas) para construir el espacio factorial. Todas son expresadas como porcentaje del PIB (%), asegurando que miden la estructura económica relativa y no el tamaño absoluto.

- ***Variables de Agrupamiento/Clasificación:***	El análisis está desagregado por 14 Regiones geográficas predefinidas (e.g., Latinoamérica y el Caribe, Europa Occidental, África Subsahariana), lo que facilita una interpretación geopolítica de los resultados.

## **1. Análisis exploratorio**

```{r carga_datos, echo=FALSE}
df = read_excel("Datos.xlsx", sheet="Data", na="..")
df = df %>%
  mutate(
    Servicios = as.numeric(Servicios),
    Gastos = as.numeric(Gastos),
    Ahorro = as.numeric(Ahorro),
    Exportaciones = as.numeric(Exportaciones),
    Importaciones = as.numeric(Importaciones),
    Produccion = as.numeric(Produccion),
    Inversion_Extranjera_Entrada = as.numeric(Inversion_Extranjera_Entrada),
    Inversion_Extranjera_Salida = as.numeric(Inversion_Extranjera_Salida),
    Deuda = as.numeric(Deuda),
    Recaudacion_Impuestos = as.numeric(Recaudacion_Impuestos),
    Agricultura = as.numeric(Agricultura),
    Remesas = as.numeric(Remesas),
    Gastos_Militares = as.numeric(Gastos_Militares)
  )
```

### **1.1. Revisión de datos faltantes**

```{r nulos, echo=FALSE}
# Revisar si hay faltantes
nulos = colSums(is.na(df))

kable(nulos, caption = "Datos faltantes") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

***Limpiar faltantes:*** El proceso de aseguramiento de la calidad de los datos es fundamental antes de aplicar el Análisis Factorial Múltiple Dual (DMFA). La fase de limpieza de nulos se centra en la correcta identificación y conversión de los valores ausentes (.. a NA). Para mejorar la robustez del modelo, es imperativo eliminar registros completos si estos carecen de datos en la totalidad de las variables activas, o considerar la eliminación de variables cuyo volumen de nulos sea tan extremo que comprometa la estructura factorial. No obstante, para preservar las trayectorias de los países y mantener la máxima cantidad de información valiosa, el método preferido para los pocos nulos restantes será la imputación de datos faltantes. a conitnuación, se detalla el paso a paso realizado para la limpiea de datos faltantes:

- Interpolación de variables, usando el método na.spline.
- Exclusión de registros, en los casos en los que todos los datos sean faltantes para las series numéricas.
- Eliminación de variables, si la cantidad sigue siendo significativa: una cantidad mayor a 40% de datos faltantes serán eliminadas.
- Si quedan faltantes en algunos países, se imputarán los registros con base en la mediana de la región al que pertenecen y el año.

```{r limpieza_nulos, echo=FALSE}
# Limpiar faltantes
df_clean = df %>%
  group_by(Pais) %>%
  arrange(Año) %>%
  mutate(across(where(is.numeric), ~na.spline(.x, x=Año, na.rm = FALSE))) %>%
  mutate(Año = as.character(Año))

# Eliminar registros completos si todas las filas son faltantes
df_clean <- df_clean %>%
  ungroup() %>%  # Desagrupa para evitar conflictos
  filter(rowSums(!is.na(select(., where(is.numeric)))) > 0)

# Eliminación de variables
df_clean = df_clean %>%
  select(where(~ mean(is.na(.)) <= 0.4))

# Imputación de datos faltantes
df_clean = df_clean %>%
  group_by(Año, Region) %>%
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), median(. , na.rm = TRUE), .))) %>%
  mutate(Año = as.character(Año))

df_clean = df_clean %>%
  ungroup()
```


```{r nulos2, echo=FALSE}
# Revisar si hay faltantes
nulos = colSums(is.na(df_clean))

kable(nulos, caption = "Datos faltantes") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Con los datos limpios, se procede a hacer el análisis exploratorio.

### **1.2. Análisis multivariado**

#### **Variables numéricas vs. Año y Región**

##### **Análisis general por región**
```{r multivariado_general, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2019", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")


df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región")
print(boxplots)
```

En términos generales, haciendo una desagregación de cada variable económica por región, se puede decir que:

```{r multivariado_general_analisis, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
analisis_multivariado_general = data.frame(
  "Hallazgo Clave por Variable" = c(
    "Estructura Productiva (Agricultura/Producción/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "África Subsahariana y Asia Central/Sur: Alta dependencia agrícola (valores altos y dispersos).\nNorteamérica y Europa Occidental son regiones que se destacan con valores altos en el rubro de servicios, y los países de Lationamérica también es destacable lo que aporta el sector servicio en el PIB de estos países. Por otro lado, África Subsahariana y Asia Central/Sur tienen los valores más bajos. En producción, las regiones son similares, pero Norteamérica es la región más baja en este rubro.",
    "En general, los países asiáticos al parecen tienen una mayor tendencia al ahorro, con base en la mediana de estas regiones con respecto a las demás regiones. Destacan Asia del Este y Europa Occidental, con mayor tendencia al Ahorro y variabilidad.\nÁfrica Subsahariana y Norte de África: Valores de Ahorro más bajos.\nEn cuanto a recaudación de impuestos, Europa Occidental presenta una mediana elevada en esta variable, mientras Oriente Medio el que tiene la mediana más baja.",
    "Europa (Occidental/Este): mayor integración comercial (Altas Exportaciones e Importaciones).\nNorteamérica/Asia del Este: Grandes Importadores.",
    "Latinoamérica y el Caribe y Asia Central/Sur: Valores altos y dependencia estructural de Remesas.",
    "Oriente Medio: Alta prioridad y gasto en la dimensión militar.\nNorteamérica y Europa Occidental: Alto Gasto Total del gobierno."
  )
)

# Generamos la tabla con kableExtra
kable(analisis_multivariado_general,
      format = "html",
      align = "l",
      caption = "Análisis de Patrones de Variables por Región (General)") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )
```

##### **Año 2019**
```{r multivariado_2019, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(Año == "2019") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región - Año 2019", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2019", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")


df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región para el año 2019")
boxplots
```

Haciendo un análisis por región, para el año 2019 se tiene lo siguiente:
```{r analisis_multivariado_2019, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")
analisis_2019 = data.frame(
  Categoria = c(
    "Estructura Productiva (Agricultura/Producción/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "Agricultura: muy alta y dispersa en África Subsahariana y Asia Central/Sur; baja y estable en Europa Occidental y Norteamérica.\nProducción: Norteamérica, Europa Occidental y Asia del Este/Pacífico por encima de las demás regiones; África Subsahariana y Asia Central/Sur rezagadas.\nServicios: altos en Europa Occidental y Norteamérica; medios-altos en Asia del Este/Pacífico; bajos en África Subsahariana y Asia Central/Sur.\n\n En términos generales, se mantienen los mismos patrones y las jerarquías regionales comparado con el análisis global (sin temporalidad), reforzando el patrón global, con contrastes más marcados (especialmente en Agricultura alta en regiones emergentes y Servicios/Producción altos en avanzadas).",
    "Recaudación: alta y consistente en Europa Occidental y Norteamérica; baja y muy heterogénea en África Subsahariana y Asia Central/Sur; intermedia en Latinoamérica.\nAhorro: alto en Asia del Este/Pacífico y Europa Occidental; bajo en África Subsahariana; variabilidad visible en Europa del Este y Latinoamérica.\nsimilar al grupo anterior, 2019 mantiene consistencia con el análisis sin temporalidad, pero se observa un poco más de heterogeneidad intra-regional en regiones de menor ingreso.",
    "Exportaciones/Importaciones con medianas altas en Europa Occidental, Norteamérica y Asia del Este/Pacífico; bajas en África Subsahariana y Asia Central/Sur. Latinoamérica y Europa del Este muestran dispersión notable (combinación de economías muy abiertas y otras menos).\nEn general, 2019 es congruente con el patrón sin temporalidad; resalta más heterogeneidad en regiones intermedias (LatAm o Europa del Este).",
    "Muy altas (y muy dispersas) en Asia Central/Sur y Latinoamérica; bajas o casi nulas en Europa Occidental, Norteamérica y Asia del Este/Pacífico. Distribuciones con colas superiores marcadas por países puntuales en estas regiones.\n Esta categoria ern el año 2019 replica el patrón sin temporalidad.",
    "Gasto total: alto en Norteamérica y Europa Occidental; bajo en África Subsahariana; intermedio en Latinoamérica y Europa del Este.\nGasto militar: Oriente Medio muestra valores muy elevados con outliers pronunciados; Norteamérica alto pero más estable; las demás regiones en niveles moderados a bajos.\n El año 2019 acentúa los picos de gasto militar en Oriente Medio (debido a la constante tensión con Israeel y sus países vecinos) y mantiene el liderazgo de gasto total en regiones avanzadas."
  )
)

# Generamos la tabla con kableExtra
kable(analisis_2019,
      format = "html",
      align = "l",
      caption = "Análisis de Patrones Regionales - Año 2019") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )
```

##### **Año 2020**
```{r multivariado_2020, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(Año == "2020") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región - Año 2020", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2020", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")


df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región para el año 2020")
boxplots
```

Para el 2020, la pandemia del COVID-19 afectó en cuánto a los gastos, recaudación de impuestos o ahorros. sin embargo, los patrones siguen siendo similares. A continuación, se resumen los hallazgos:
```{r analisis_multivariado_2020, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")
analisis_2020 = data.frame(
  Categoria = c(
    "Estructura Productiva (Agricultura/Producción/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "En el 2020, África Subsahariana y Asia Central/Sur mantienen sus patrones con Agricultura alta y dispersa; Europa Occidental y Norteamérica con Agricultura baja y estable.\nProducción/Servicios altos y más compactos en Europa Occidental, Norteamérica y Asia del Este/Pacífico, pero ligeramente más bajos que el 2019 (efecto pandemia); bajos en África Subsahariana y Asia Central/Sur; mayor heterogeneidad en regiones emergentes.\nComparando con el 2019 y patrón sin temporalidad, se mantienen las jerarquías regionales, aunque en 2020 se observan contrastes algo más marcados en extremos y ligero aumento de dispersión en regiones intermedias (Latinoamérica, Europa del Este).",
    "En 2020, Recaudación sigue siendo alta y consistente en Europa Occidental/Norteamérica; baja y heterogénea en África Subsahariana/Asia Central-Sur; intermedia en Latinoamérica y ligeramente bajo vs 2019.\nAhorro elevado en Asia del Este/Pacífico y Europa Occidental; bajo en África Subsahariana; variabilidad en Europa del Este y Latinoamérica.\nComparando con 2019 hay un ligero aumento de heterogeneidad en 2020 en grupos intermedios para ahorros, sin cambios en el orden relativo, y es un poco más homogéneo en recaudación de impuestos. Versus el patrón sin temporalidad, no hay cambios mayores.",
    "Exportaciones/Importaciones con medianas altas en Europa Occidental/Norteamérica/Asia del Este-Pacífico; bajas en África Subsahariana/Asia Central-Sur. Latinoamérica y Europa del Este con dispersión notable (brechas intra-regionales).\nvs 2019: el patrón es similar; 2020 muestra algo más de heterogeneidad en regiones mixtas, pero medianas bajas vs 2019, acentuando el efecto de pandemia. vs patrones sin temporalidad: Misma jerarquía; el global presenta dispersión más moderada; 2020 acentúa diferencias dentro de regiones intermedias.",
    "En el 2020, las remsesas siguen siendo muy altas y muy dispersas en Asia Central/Sur y Latinoamérica; bajas o casi nulas en Europa Occidental/Norteamérica/Asia del Este-Pacífico. Distribuciones con colas superiores dominadas por pocos países.\nvs 2019 y patrón sin temporalidad, el 2020 hace más visibles los máximos y colas en la distribución de las remesas a nivel regional.",
    "Gasto total alto en Norteamérica/Europa Occidental; bajo en África Subsahariana; intermedio en Latinoamérica/Europa del Este.\nGasto militar: Oriente Medio con outliers muy elevados; Norteamérica alto pero más estable; las demás regiones moderado-bajo. esto indica la influencia de la pandemia, en el que los gastos fueron llevados más a controlar la epidemia y a la salud de las personas, inviertiendo menos en otros rubreos como el militar."
  )
)

# Generamos la tabla con kableExtra
kable(analisis_2020,
      format = "html",
      align = "l",
      caption = "Análisis de Patrones Regionales - Año 2020") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )
```

##### **Año 2021**
```{r multivariado_2021, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(Año == "2021") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región - Año 2021", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2021", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región para el año 2021")
boxplots
```

El 2021 presenta una leve recuperación comparando con el 2020, debido a la "normalidad" pos-COVID19. A continuación, se presentan los siguientes hallazgos:
```{r analisis_multivariado_2021, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")
analisis_2021 = data.frame(
  Categoria = c(
    "Estructura Productiva (Agricultura/Producción/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "En el 2021 se mantiene la jerarquía: Europa Occidental y Norteamérica con Producción/Servicios altos y compactos y Agricultura baja; África Subsahariana y Asia Central/Sur con Agricultura alta y dispersa y Producción/Servicios bajos; Asia del Este/Pacífico en niveles altos/intermedios con menor dispersión.\nComparando con el 2020: Se recuperan ligeramente las medianas de Producción/Servicios en regiones avanzadas (leve repunte respecto al bache de 2020); Agricultura sin cambios sustantivos de posición. vs patrón sin temporalidad: coincide la ordenación estructural; el general suaviza picos/colas; 2021 enfatiza extremos puntuales.",
    "Recaudación alta y estable en Europa Occidental/Norteamérica; baja y heterogénea en África Subsahariana/Asia Central-Sur; Latinoamérica intermedia. Ahorro elevado en Asia del Este/Pacífico y Europa Occidental; bajo en África Subsahariana; variabilidad visible en Europa del Este y LatAm.\nvs 2020: se recupera levementa la Recaudación y Ahorro en regiones avanzadas, aunque en regiones emergentes persiste heterogeneidad. vs patrones sin temporalidad: se exhibe menor variabilidad interna.",
    "Para el año 2021, las Exportaciones/Importaciones mantienen medianas altas en Europa Occidental/Norteamérica/Asia del Este-Pacífico; bajas en África Subsahariana/Asia Central-Sur; LatAm y Europa del Este con dispersión notable, por la mezcla de economías muy abiertas y menos abiertas.\nvs 2020: se observa un incremento en medianas (reapertura y normalización del comercio) en regiones avanzadas y parte de Asia del Este/Pacífico; regiones rezagadas permanecen por debajo. vs patrón sin temporalidad: 2021 muestra brechas intra-regionales más visibles en regiones mixtas.",
    "En el 2021, las remesas se mantienen muy altas y dispersas en Asia Central/Sur y Latinoamérica; bajas o casi nulas en Europa Occidental/Norteamérica/Asia del Este-Pacífico. Se mantienen colas superiores por pocos países.\nvs 2020: Igual o ligeramente mayor en las regiones líderes (las medianas se ven tan altas o un poco más); regiones avanzadas siguen bajas. vs patrones sin temporalidad: El global amortigua extremos; 2021 hace más visibles picos concentrados.",
    "Gasto total sin cambio en sus patrones: alto en Europa Occidental/Norteamérica; bajo en África Subsahariana; intermedio en LatAm/Europa del Este. Gasto militar: Oriente Medio conserva outliers muy elevados; Norteamérica alto pero más estable; el resto moderado/bajo.\nvs 2020: Niveles similares o ligeramente superiores en Gasto total en avanzadas (continúa la senda de normalización); Gasto militar mantiene picos en Oriente Medio sin cambios de orden. vs Global: Mismo patrón; el global suaviza outliers, mientras 2021 resalta máximos."
  )
)

# Generamos la tabla con kableExtra
kable(analisis_2021,
      format = "html",
      align = "l",
      caption = "Análisis de Patrones Regionales - Año 2021") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )
```

##### **Año 2022**
```{r multivariado_2022, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(Año == "2022") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región - Año 2022", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2022", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región para el año 2022")
boxplots
```

El año 2022 sigue en recuperación luego de la pandemia del 2020, por ende, la mayoría de los indicadores tienden a aumentar. a continuación, se repsentan los hallazgos para este año:
```{r analisis_multivariado_2022, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")
analisis_2022 = data.frame(
  Categoria = c(
    "Estructura Productiva (Agricultura/Producción/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "Agricultura: 2022 mantiene medianas altas en África Subsahariana y Asia Central/Sur (sin cambios relevantes vs 2019–2021) y bajas en Europa Occidental/Norteamérica.\nProducción: 2022 muestra medianas ligeramente superiores a 2021 en Europa Occidental/Norteamérica (consolidación tras 2020) y altas estables en Asia del Este/Pacífico; bajas estables en África Subsahariana/Asia Central-Sur.\nServicios: 2022 con medianas iguales o algo mayores que 2021 en Europa Occidental; Norteamérica se mantiene alta; LatAm intermedia con dispersión; África Subsahariana baja.",
    "Recaudación: 2022 con medianas levemente por encima de 2021 en Europa Occidental; Norteamérica estable-alta; África Subsahariana baja estable; LatAm intermedia estable.\nAhorro: 2022 alto y estable en Asia del Este/Pacífico; Europa Occidental ligero incremento vs 2021; África Subsahariana baja; Europa del Este con variabilidad.\nVs 2019–2021: no hay cambios de jerarquía; se observan ajustes menores al alza en economías avanzadas.",
    "Para el año 2022, las Exportaciones/Importaciones presentan medianas más altas que 2021 en Europa Occidental/Norteamérica y ligero aumento en Asia del Este/Pacífico (normalización pos-pandemia); LatAm y Europa del Este mantienen medianas intermedias con amplia dispersión; África Subsahariana/Asia Central-Sur bajas estables. Vs 2020: 2022 se ubica claramente por encima (continuación de la recuperación). Vs 2019: 2022 aparece similar o levemente superior en economís avanzadas; similar en economías rezagadas. ",
    "El año 2022 mantiene medianas altas en Asia Central/Sur y LatAm, similares o marginalmente superiores a 2021; Europa Occidental/Norteamérica/Asia del Este-Pacífico permanecen bajas.",
    "Gasto total: año 2022 alto y estable en Europa Occidental/Norteamérica (medianas igualwa o ligeramente superiores vs 2021), bajo en África Subsahariana, intermedio en LatAm/Europa del Este.\nGasto militar: 2022 sin cambios de mediana relevantes a simple vista; Oriente Medio conserva valores altos con outliers; Norteamérica alto y estable; resto moderado-bajo."
  )
)

# Generamos la tabla con kableExtra
kable(analisis_2022,
      format = "html",
      align = "l",
      caption = "Análisis de Patrones Regionales - Año 2022") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )
```

##### **Año 2023**
```{r multivariado_2023, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(Año == "2023") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región - Año 2023", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2023", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free", ncol=3, nrow=4) +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región para el año 2023")
boxplots
```

El año 2023 presenta una recuperación consolidad luego de la pandemia del COVID-19, y persisten brechas en algunas regiones como África Subsahariana y Asia Central/Sur.

```{r analisis_multivariado_2023, fig.width=10, fig.height=8, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")
analisis_2023 = data.frame(
  Categoria = c(
    "Estructura Productiva (Agricultura/Producción/Servicios)",
    "Solidez Fiscal y Ahorro",
    "Apertura Comercial (Exp. e Imp.)",
    "Flujos de Capital (Remesas)",
    "Gasto y Seguridad (Gastos/Gastos Militares)"
  ),
  "Patrones Destacados" = c(
    "Agricultura: 2023 mantiene consistencia en África Subsahariana y Asia Central/Sur, sin cambios relevantes vs 2022; dispersión ligeramente menor (menos outliers).\nProducción: medianas levemente altas en Europa Occidental y Norteamérica (recuperación consolidada),pero similar en Asia del Este/Pacífico vs el año anterior; regiones rezagadas sin mejora visible.\nServicios: medianas levemente altas en Europa Occidental y Norteamérica vs 2022; LatAm estable; África Subsahariana sigue baja.\nPatrón nuevo: ligera reducción de dispersión en regiones avanzadas (cajas más compactas).",
    "Recaudación: medianas con aumento leve en Europa Occidental y Norteamérica vs 2022; LatAm estable; África Subsahariana sigue baja.\nAhorro: medianas altas en Asia del Este/Pacífico y Europa Occidental (máximos del periodo); LatAm y África Subsahariana sin cambios.\nPatrón nuevo: Asia del Este/Pacífico consolida liderazgo en ahorro con menor dispersión.",
    "Exportaciones: medianas altas en Europa Occidental y Norteamérica (superan niveles 2022 y se acercan a 2019); LatAm y Europa del Este con dispersión alta; África Subsahariana estable.\nImportaciones: patrón similar; medianas ↑ en avanzadas, ≈ en rezagadas.\nPatrón nuevo: 2023 marca máximos post-2020 en comercio para regiones avanzadas.",
    "Medianas similares en Asia Central/Sur y LatAm (altas); ligero aumento en LatAm vs 2022; regiones avanzadas siguen bajas. Dispersión alta persiste (colas superiores). Se mantiene concentración en pocas economías.",
    "Gasto total: medianas levemente superiores en Europa Occidental y Norteamérica (máximos del periodo); LatAm estable; África Subsahariana baja.\nGasto militar: sin cambios sustantivos; Oriente Medio sigue con outliers altos, especialmente por la guErra Israel-Palestina.\nPatrón nuevo: consolidación de gasto público alto en economías avanzadas."
  )
)

# Generamos la tabla con kableExtra
kable(analisis_2023,
      format = "html",
      align = "l",
      caption = "Análisis de Patrones Regionales - Año 2022") %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center"
  )
```

##### **Correlación**
```{r correlacion, fig.width=10, fig.height=10, fig.align='center', echo=FALSE}
df_sel = df_clean %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares
    )
                
# Calcula la matriz de correlación
corr_matrix = round(cor(df_sel), 2)

ggcorrplot(corr_matrix,
  lab = TRUE,             # Muestra los coeficientes de correlación en el gráfico
  type = "lower",         # Muestra solo la matriz triangular inferior
  outline.col = "white",  # Color del borde de los cuadrados
  ggtheme = ggplot2::theme_gray, # Tema de ggplot
  colors = c("#6D9EC1", "white", "#E46726") # Colores para correlaciones negativas, cero y positivas
) +
labs(title = "Matriz de Correlación") +
theme(
  plot.title = element_text(hjust = 0.5, face = "bold", size = 14)
)
```

En cuanto a las asociaciones entre variables presentan lo siguiente:

- **Comercio exterior:** Exportaciones ↔ Importaciones muestran una correlación alta (≈ 0.81), lo que se puede deducir en que actúan como un mismo factor de apertura comercial; países que exportan más, también importan más.
- **Flujos de capital internacional:** Inversión Extranjera – Entrada ↔ Salida presentan una correlación casi perfecta (≈ 0.93), reflejando un mismo perfil financiero; economías que reciben capital también invierten fuera (profundidad/sofisticación financiera).
- **Estructura productiva moderna:** Producción y Servicios se correlacionan positivamente (alta–moderada), además de que Recaudación de impuestos y Ahorro también tienden a correlacionar positivamente con Producción y Servicios. Lo anterior puede conducir a que hay un núcleo de desarrollo interno (mayor producción y terciarización) asociado a mejor base fiscal y mayor ahorro.
- **Agricultura inverso a producción y servicios:** mayor peso agrícola se asocia con menor capacidad fiscal y menor terciarización, actuando como indicador inverso de modernización.
- **Remesas:** tiene correlaciones bajas con la mayoría de variables, por lo que estas pueden capturar una dinámica específica (migración/ingreso externo de hogares) poco alineada con los ejes de comercio, capital y estructura productiva.

## **2. Análisis factorial múltiple**
```{r modelo, echo=FALSE, warning=FALSE}
BaseDUAL = df_clean %>%
  dplyr::select(
    Region,
    Año,
    Agricultura,
    Gastos,
    Produccion,
    Exportaciones,
    Importaciones,
    Remesas,
    Servicios,
    Recaudacion_Impuestos,
    Inversion_Extranjera_Entrada,
    Inversion_Extranjera_Salida,
    Ahorro,
    Gastos_Militares
  )

# Aplicar análisis multifactorial
res.dmfa = DMFA(
  BaseDUAL,
  num.fact = 2,
  quali.sup = 1,
  graph = FALSE
)
```

### **Varianza explicada y contribuciones de las variables por dimensión**
```{r eigenvalues, echo=FALSE, warning=FALSE, fig.align='center'}
eig = as.data.frame(res.dmfa$eig)
eig$Dim = seq_len(nrow(eig))
eig$Dim = factor(paste0("Dim ", eig$Dim),
                    levels = paste0("Dim ", eig$Dim))

ggplot(eig, aes(x = Dim)) +
  geom_col(aes(y = `percentage of variance`), fill = "#2C7FB8", width = 0.7) +
  geom_text(aes(y = `percentage of variance`, label = paste0(round(`percentage of variance`, 1), "%")),
            vjust = -0.5, size = 3.3) +
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  labs(
    title = "Porcentaje de varianza explicada",
    x = "Dimensión",
    y = "Porcentaje"
  ) +
  theme_minimal(base_size = 12)
```

Hallazgos y tratar de nombrar cada dimensión

```{r contribuciones, fig.width=8, echo=FALSE, warning=FALSE, dpi=150, fig.align='center'}
# Contribución
coords = as.data.frame(res.dmfa$var$coord)
dims_plot = names(coords)
coords$Variable = rownames(coords)

coord_long = coords %>%
  pivot_longer(cols = dims_plot, names_to = "Dim", values_to = "Carga") %>%
  mutate(Signo = if_else(Carga >= 0, "Positivo", "Negativo"))

ggplot(coord_long, aes(x = Carga, y = Variable, fill = Signo)) +
  geom_col(width = 0.8, alpha = 0.95) +
  facet_wrap(~ Dim, scales = "free_y") +
  scale_fill_manual(values = c("Positivo" = "#2E8B57", "Negativo" = "#D73027")) + # verde/rojo
  labs(
    title = "Cargas por variable y dimensión",
    x = "Carga (coordenada en la dimensión)",
    y = "Variable",
    fill = ""
  ) +
  theme_light() +
  theme(legend.position = "none")
```

Hallazgos

### **Análisis por individuo (países)**
```{r analisis_paises, echo=FALSE, warning=FALSE, fig.align='center'}
# Muestra a los individuos (países) en el plano factorial.
plot.DMFA(res.dmfa, choix="ind",invisible="quali", label="none", new.plot=TRUE)
```

Hallazgos

### **Análisis por año**
```{r analisis_2019, echo=FALSE, warning=FALSE, fig.align='center'}
group_vars1 = as.data.frame(res.dmfa$var.partiel$Gr2019)
group_vars1$Variable = rownames(group_vars1)
group_vars1$Año = "2019"

group_vars2 = as.data.frame(res.dmfa$var.partiel$Gr2020)
group_vars2$Variable = rownames(group_vars2)
group_vars2$Año = "2020"

group_vars3 = as.data.frame(res.dmfa$var.partiel$Gr2021)
group_vars3$Variable = rownames(group_vars3)
group_vars3$Año = "2021"

group_vars4 = as.data.frame(res.dmfa$var.partiel$Gr2022)
group_vars4$Variable = rownames(group_vars4)
group_vars4$Año = "2022"

group_vars5 = as.data.frame(res.dmfa$var.partiel$Gr2023)
group_vars5$Variable = rownames(group_vars5)
group_vars5$Año = "2023"

lista_dfs = list(group_vars1, group_vars2, group_vars3, group_vars4, group_vars5)
group_vars = bind_rows(lista_dfs)

# Función para generar puntos de una circunferencia
circle = function(radio, n = 100) {
  theta <- seq(0, 2*pi, length.out = n)
  data.frame(
    x = radio * cos(theta),
    y = radio * sin(theta),
    r = radio
  )
}

# Crear circunferencias con radios desde 0.2 hasta 1.2
radios = seq(0.2, 1.0, by = 0.2)
circunferencias = do.call(rbind, lapply(radios, circle))

group_vars_filt = group_vars %>%
  filter(Año == "2019")
ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2)) +
  geom_point() +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), color = "gray85") +
  geom_text(aes(label = Variable), vjust = -0.5, size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por año 2019") +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

Hallazgos

```{r analisis_2020, echo=FALSE, warning=FALSE, fig.align='center'}
group_vars_filt = group_vars %>%
  filter(Año == "2020")
ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2)) +
  geom_point() +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), color = "gray85") +
  geom_text(aes(label = Variable), vjust = -0.5, size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por año 2020") +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

Hallazgos

```{r analisis_2021, echo=FALSE, warning=FALSE, fig.align='center'}
group_vars_filt = group_vars %>%
  filter(Año == "2021")
ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2)) +
  geom_point() +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), color = "gray85") +
  geom_text(aes(label = Variable), vjust = -0.5, size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por año 2021") +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

Hallazgos

```{r analisis_2022, echo=FALSE, warning=FALSE, fig.align='center'}
group_vars_filt = group_vars %>%
  filter(Año == "2022")
ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2)) +
  geom_point() +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), color = "gray85") +
  geom_text(aes(label = Variable), vjust = -0.5, size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por año 2022") +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

Hallazgos

```{r analisis_2023, echo=FALSE, warning=FALSE, fig.align='center'}
group_vars_filt = group_vars %>%
  filter(Año == "2023")
ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2)) +
  geom_point() +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), color = "gray85") +
  geom_text(aes(label = Variable), vjust = -0.5, size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por año 2023") +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

Hallazgos

### **Análisis por región**

```{r modelo_regiones_contr, echo=FALSE, warning=FALSE, fig.width=10, fig.height=8, fig.align='center'}
region_list = c(
    "África - África Subsahariana",
    "África - Norte de África",
    "América - Latinoamérica y el Caribe",
    "América - Norteamérica",
    "Asia - Asia Central y del Sur",
    "Asia - Oriente Medio",
    "Asia del Este, Pacífico y Oceanía",
    "Europa - Europa del Este",
    "Europa - Europa Occidental"
  )
regions = as.data.frame(res.dmfa$quali.sup$coord)
regions$Region = rownames(regions)

regions_filt = regions %>%
  filter(Region == region_list)

regions_filt = regions_filt %>%
  pivot_longer(cols = dims_plot, names_to = "Dim", values_to = "Carga") %>%
  mutate(Signo = if_else(Carga >= 0, "Positivo", "Negativo"))

ggplot(regions_filt, aes(x = Carga, y = Region, fill = Signo)) +
  geom_col(width = 0.8, alpha = 0.95) +
  facet_wrap(~ Dim, scales = "free_y") +
  scale_fill_manual(values = c("Positivo" = "#2E8B57", "Negativo" = "#D73027")) + # verde/rojo
  labs(
    title = "Cargas por región y dimensión",
    x = "Carga (coordenada en la dimensión)",
    y = "Variable",
    fill = ""
  ) +
  theme_light() +
  theme(legend.position = "none")
```

Hallazgos

```{r analisis_region, echo=FALSE, warning=FALSE, fig.width=10, fig.height=8, fig.align='center'}
# Visualiza las modalidades de la variable cualitativa.
plot.DMFA(res.dmfa, choix="quali",invisible="quali", label="none")
```

Hallazgos

## 3. Conclusiones

Resuma las implicaciones del análisis, comentando sobre los patrones encontrados y su relevancia para la comprensión del desarrollo global.