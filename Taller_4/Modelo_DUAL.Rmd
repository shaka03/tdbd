---
title: "Taller 4 - Modelo DUAL"
author:
  - name: "Jhon Fernando Tascon Velasco"
  - name: "Lino Alexander Sinisterra"
  - name: "Juan Sebastian Chacón"
date: "2025-09-29"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
library(readxl)
library(dplyr)
library(tidyverse)
library(plotly)
library(ggcorrplot)
library(ggplot2)
library(reshape2)
library(ResourceSelection)
library(knitr)
library(kableExtra)
library(FactoMineR)
library(scales)
library(zoo)
library(factoextra)
```

## **0. Información general**

En este trabajo se realizará un análisis factorial multiple con el fin de examinar trayectorias y agrupamientos de diferentes variables económicas, para identificar factores latentes, similitudes y diferencias a lo largo de los últimos cinco años (2019 al 2023), desagregado por regiones geográficas. Los datos están a nivel país, pero se realizó un procedimiento para agrupar los países en 14 regiones, con base en sus similitudes geográficas y étnicas. Las regiones son: Asia Central y del Sur, Oriente Medio, Asia del Este, Pacífico y Oceanía, Europa Occidental, Europa del Este, Norte de África, África Subsahariana, Latinoamérica y el Caribe y Norteamérica. 

Las variables a analizar son las siguientes:

```{r tabla_variables, echo=FALSE}
variables <- data.frame(
  Variables = c(
    "Pais",
    "Año",
    "Region",
    "Servicios",
    "Gastos",
    "Ahorro",
    "Exportaciones",
    "Importaciones",
    "Produccion",
    "Inversion_Extranjera_Entrada",
    "Inversion_Extranjera_Salida",
    "Deuda",
    "Recaudacion_Impuestos",
    "Agricultura",
    "Remesas",
    "Gastos_Militares"
  ),
  Tipo_Variable = c(
    "Nominal",
    "Ordinal",
    "Nominal",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa",
    "Cuantitativa"
  ),
  Descripción = c(
    "País",
    "Año",
    "Región",
    "Servicios, valor agregado (% PIB)",
    "Gastos (% PIB)",
    "Ahorro bruto (% PIB)",
    "Exportaciones de bienes y sevicios (% PIB)",
    "Importaciones de bienes y servicios (% PIB)",
    "Producción, valor agregado (% PIB)",
    "Inversión extranjera, entrada neta de capital (% PIB)",
    "Inversión extranjera, salidad neta de capital (% PIB)",
    "Total Deuda (% PIB)",
    "Recaudación impostivia (% PIB)",
    "Agricultura, silvicultura y pesca, valor agregado (% PIB)",
    "Remesas de trabajdores y compensación de empleados recibidas (% PIB)",
    "Gastos militares (%PIB)"
  )
)

kable(variables, format = "html", caption = "Descripción de variables del estudio", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = FALSE, position = "center")
```

## **1. Análisis exploratorio**

```{r carga_datos, echo=FALSE}
df = read_excel("Datos.xlsx", sheet="Data", na="..")
df = df %>%
  mutate(
    Servicios = as.numeric(Servicios),
    Gastos = as.numeric(Gastos),
    Ahorro = as.numeric(Ahorro),
    Exportaciones = as.numeric(Exportaciones),
    Importaciones = as.numeric(Importaciones),
    Produccion = as.numeric(Produccion),
    Inversion_Extranjera_Entrada = as.numeric(Inversion_Extranjera_Entrada),
    Inversion_Extranjera_Salida = as.numeric(Inversion_Extranjera_Salida),
    Deuda = as.numeric(Deuda),
    Recaudacion_Impuestos = as.numeric(Recaudacion_Impuestos),
    Agricultura = as.numeric(Agricultura),
    Remesas = as.numeric(Remesas),
    Gastos_Militares = as.numeric(Gastos_Militares)
  )
```

### **1.1. Revisión de datos faltantes**

```{r nulos, echo=FALSE}
# Revisar si hay faltantes
nulos = colSums(is.na(df))

kable(nulos, caption = "Datos faltantes") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Se identifica una cantidad significativa de valores faltantes en las series numéricas, se realizará un proceso de imputación de variables que incluirá:

- Interpolación de variables, usando el método na.spline.
- Exclusión de registros, en los casos en los que todos los datos sean faltantes para las series numéricas.
- Eliminación de variables, si la cantidad sigue siendo significativa: una cantidad mayor a 40% de datos faltantes serán eliminadas.
- Si quedan faltantes en algunos países, se imputarán los registros con base en la mediana de la región al que pertenecen y el año.

```{r limpieza_nulos, echo=FALSE}
# Limpiar faltantes
df_clean = df %>%
  group_by(Pais) %>%
  arrange(Año) %>%
  mutate(across(where(is.numeric), ~na.spline(.x, x=Año, na.rm = FALSE))) %>%
  mutate(Año = as.character(Año))

# Eliminar registros completos si todas las filas son faltantes
df_clean <- df_clean %>%
  ungroup() %>%  # Desagrupa para evitar conflictos
  filter(rowSums(!is.na(select(., where(is.numeric)))) > 0)

# Eliminación de variables
df_clean = df_clean %>%
  select(where(~ mean(is.na(.)) <= 0.4))

# Imputación de datos faltantes
df_clean = df_clean %>%
  group_by(Año, Region) %>%
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), median(. , na.rm = TRUE), .))) %>%
  mutate(Año = as.character(Año))

df_clean = df_clean %>%
  ungroup()
```

```{r nulos2, echo=FALSE}
# Revisar si hay faltantes
nulos = colSums(is.na(df_clean))

kable(nulos, caption = "Datos faltantes") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Ya la data está limpia para poder ser usada en los análisis posteriores.

### **1.2. Resumen de las variables**

```{r descripcion, echo=FALSE}
resumen = summary(df_clean)
kable(t(resumen), caption = "Descripción del conjunto de datos") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Hallazgos

#### **Análisis univariado de las variables numéricas**

```{r numericas, fig.width=10, fig.height=10, fig.align='center', echo=FALSE, message=FALSE}
cat("\n")
# Crear histogramas con facetas
df_long = df_clean %>%
  dplyr::select(
    Agricultura,
    Gastos,
    Produccion,
    Exportaciones,
    Importaciones,
    Remesas,
    Servicios,
    Recaudacion_Impuestos,
    Inversion_Extranjera_Entrada,
    Inversion_Extranjera_Salida,
    Ahorro,
    Gastos_Militares
  )

df_long = pivot_longer(
  df_long,
  cols = c(
    Agricultura,
    Gastos,
    Produccion,
    Exportaciones,
    Importaciones,
    Remesas,
    Servicios,
    Recaudacion_Impuestos,
    Inversion_Extranjera_Entrada,
    Inversion_Extranjera_Salida,
    Ahorro,
    Gastos_Militares
  ),
  names_to = "Variable",
  values_to = "Valor"
)

histogramas = ggplot(df_long, aes(x = Valor, fill = Variable)) +
  geom_histogram(bins=15) +
  facet_wrap(~Variable, scales = "free") +
  theme_light() +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5)) +
  labs(title="Histogramas de las variables numéricas")
histogramas
```

Hallazgos

```{r numericas_2, fig.width=10, fig.height=10, fig.align='center', echo=FALSE, message=FALSE}
boxplots = ggplot(df_long, aes(y = Valor, fill = Variable)) +
  geom_boxplot() +
  facet_wrap(~Variable, scales = "free") +
  theme_light() +
  theme(legend.position = "none",
    plot.title = element_text(hjust = 0.5)) +
  labs(title = "Boxplots de las variables numéricas")
boxplots
```

Hallazgos

### **1.3. Análisis multivariado**

#### **Variables numéricas vs. Año y Región**

##### **Año 2019**
```{r multivariado_2019, fig.width=10, fig.height=6, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(Año == "2019") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región - Año 2019", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2019", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")


df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región para el año 2019")
boxplots
```

Hallazgos

##### **Año 2020**
```{r multivariado_2020, fig.width=10, fig.height=6, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(Año == "2020") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región - Año 2020", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2020", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")


df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región para el año 2020")
boxplots
```

Hallazgos

##### **Año 2021**
```{r multivariado_2021, fig.width=10, fig.height=6, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(Año == "2021") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región - Año 2021", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2021", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región para el año 2021")
boxplots
```

Hallazgos

##### **Año 2022**
```{r multivariado_2022, fig.width=10, fig.height=6, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(Año == "2022") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región - Año 2022", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2022", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región para el año 2022")
boxplots
```

Hallazgos

##### **Año 2023**
```{r multivariado_2023, fig.width=10, fig.height=6, fig.align='center', echo=FALSE, warning=FALSE}
cat("\n")

df_long = df_clean %>%
  filter(Año == "2023") %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares,
                Region)

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      mediana = ~round(median(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Mediana por Región - Año 2023", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_stats = df_long %>%
  group_by(Region) %>%
  summarise(across(where(is.numeric), list(
      sd = ~round(sd(.x, na.rm = TRUE), 2)
    ), .names = "{.col}"))

kable(t(df_stats), format = "html", caption = "Desviación estándar por Región - Año 2023", align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = TRUE, position = "center")

df_long = df_long %>%
  pivot_longer(cols = c(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares),
               names_to = "Variable",
               values_to = "Valor")

# Crear el gráfico de boxplots
boxplots = ggplot(df_long, aes(x = Variable, y = Valor, fill = Region)) +
geom_boxplot() +
  facet_wrap(~Variable, scales = "free") +
  theme_light() +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(title = "Distribución de las variables numéricas por región para el año 2023")
boxplots
```

Hallazgos

```{r correlacion, fig.width=10, fig.height=10, fig.align='center', echo=FALSE}
df_sel = df_clean %>%
  dplyr::select(Agricultura,
                Gastos,
                Produccion,
                Exportaciones,
                Importaciones,
                Remesas,
                Servicios,
                Recaudacion_Impuestos,
                Inversion_Extranjera_Entrada,
                Inversion_Extranjera_Salida,
                Ahorro,
                Gastos_Militares
    )
                
# Calcula la matriz de correlación
corr_matrix = round(cor(df_sel), 2)

ggcorrplot(corr_matrix,
  lab = TRUE,             # Muestra los coeficientes de correlación en el gráfico
  type = "lower",         # Muestra solo la matriz triangular inferior
  outline.col = "white",  # Color del borde de los cuadrados
  ggtheme = ggplot2::theme_gray, # Tema de ggplot
  colors = c("#6D9EC1", "white", "#E46726") # Colores para correlaciones negativas, cero y positivas
) +
labs(title = "Matriz de Correlación") +
theme(
  plot.title = element_text(hjust = 0.5, face = "bold", size = 14)
)
```

Hallazgos

## **2. Análisis factorial múltiple**
```{r modelo, echo=FALSE, warning=FALSE}
BaseDUAL = df_clean %>%
  dplyr::select(
    Region,
    Año,
    Agricultura,
    Gastos,
    Produccion,
    Exportaciones,
    Importaciones,
    Remesas,
    Servicios,
    Recaudacion_Impuestos,
    Inversion_Extranjera_Entrada,
    Inversion_Extranjera_Salida,
    Ahorro,
    Gastos_Militares
  )

# Aplicar análisis multifactorial
res.dmfa = DMFA(
  BaseDUAL,
  num.fact = 2,
  quali.sup = 1,
  graph = FALSE
)
```

### **Varianza explicada y contribuciones de las variables por dimensión**
```{r eigenvalues, echo=FALSE, warning=FALSE}
eig = as.data.frame(res.dmfa$eig)
eig$Dim = seq_len(nrow(eig))
eig$Dim = factor(paste0("Dim ", eig$Dim),
                    levels = paste0("Dim ", eig$Dim))

ggplot(eig, aes(x = Dim)) +
  geom_col(aes(y = `percentage of variance`), fill = "#2C7FB8", width = 0.7) +
  geom_text(aes(y = `percentage of variance`, label = paste0(round(`percentage of variance`, 1), "%")),
            vjust = -0.5, size = 3.3) +
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  labs(
    title = "Porcentaje de varianza explicada",
    x = "Dimensión",
    y = "Porcentaje"
  ) +
  theme_minimal(base_size = 12)
```

Hallazgos y tratar de nombrar cada dimensión

```{r contribuciones, fig.width=8, echo=FALSE, warning=FALSE, dpi=150}
# Contribución
coords = as.data.frame(res.dmfa$var$coord)
dims_plot = names(coords)
coords$Variable = rownames(coords)

coord_long = coords %>%
  pivot_longer(cols = dims_plot, names_to = "Dim", values_to = "Carga") %>%
  mutate(Signo = if_else(Carga >= 0, "Positivo", "Negativo"))

ggplot(coord_long, aes(x = Carga, y = Variable, fill = Signo)) +
  geom_col(width = 0.8, alpha = 0.95) +
  facet_wrap(~ Dim, scales = "free_y") +
  scale_fill_manual(values = c("Positivo" = "#2E8B57", "Negativo" = "#D73027")) + # verde/rojo
  labs(
    title = "Cargas por variable y dimensión",
    x = "Carga (coordenada en la dimensión)",
    y = "Variable",
    fill = ""
  ) +
  theme_light() +
  theme(legend.position = "none")
```

Hallazgos

### **Análisis por individuo (países)**
```{r analisis_paises, echo=FALSE, warning=FALSE}
# Muestra a los individuos (países) en el plano factorial.
plot.DMFA(res.dmfa, choix="ind",invisible="quali", label="none", new.plot=TRUE)
```

Hallazgos

### **Análisis por año**
```{r analsis_2019, echo=FALSE, warning=FALSE}
group_vars1 = as.data.frame(res.dmfa$var.partiel$Gr2019)
group_vars1$Variable = rownames(group_vars1)
group_vars1$Año = "2019"

group_vars2 = as.data.frame(res.dmfa$var.partiel$Gr2020)
group_vars2$Variable = rownames(group_vars2)
group_vars2$Año = "2020"

group_vars3 = as.data.frame(res.dmfa$var.partiel$Gr2021)
group_vars3$Variable = rownames(group_vars3)
group_vars3$Año = "2021"

group_vars4 = as.data.frame(res.dmfa$var.partiel$Gr2022)
group_vars4$Variable = rownames(group_vars4)
group_vars4$Año = "2022"

group_vars5 = as.data.frame(res.dmfa$var.partiel$Gr2023)
group_vars5$Variable = rownames(group_vars5)
group_vars5$Año = "2023"

lista_dfs = list(group_vars1, group_vars2, group_vars3, group_vars4, group_vars5)
group_vars = bind_rows(lista_dfs)

# Función para generar puntos de una circunferencia
circle = function(radio, n = 100) {
  theta <- seq(0, 2*pi, length.out = n)
  data.frame(
    x = radio * cos(theta),
    y = radio * sin(theta),
    r = radio
  )
}

# Crear circunferencias con radios desde 0.2 hasta 1.2
radios = seq(0.2, 1.0, by = 0.2)
circunferencias = do.call(rbind, lapply(radios, circle))

group_vars_filt = group_vars %>%
  filter(Año == "2019")
ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2)) +
  geom_point() +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), color = "gray85") +
  geom_text(aes(label = Variable), vjust = -0.5, size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por año 2019") +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

Hallazgos

```{r analsis_2020, echo=FALSE, warning=FALSE}
group_vars_filt = group_vars %>%
  filter(Año == "2020")
ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2)) +
  geom_point() +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), color = "gray85") +
  geom_text(aes(label = Variable), vjust = -0.5, size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por año 2020") +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

Hallazgos

```{r analsis_2021, echo=FALSE, warning=FALSE}
group_vars_filt = group_vars %>%
  filter(Año == "2021")
ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2)) +
  geom_point() +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), color = "gray85") +
  geom_text(aes(label = Variable), vjust = -0.5, size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por año 2021") +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

Hallasgos

```{r analsis_2022, echo=FALSE, warning=FALSE}
group_vars_filt = group_vars %>%
  filter(Año == "2022")
ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2)) +
  geom_point() +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), color = "gray85") +
  geom_text(aes(label = Variable), vjust = -0.5, size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por año 2022") +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

Hallazgos

```{r analsis_2023, echo=FALSE, warning=FALSE}
group_vars_filt = group_vars %>%
  filter(Año == "2023")
ggplot(group_vars_filt, aes(x=Dim.1, y=Dim.2)) +
  geom_point() +
  geom_path(data = circunferencias, aes(x = x, y = y, group = r), color = "gray85") +
  geom_text(aes(label = Variable), vjust = -0.5, size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 0, linetype = "dashed", color = "black") +
  coord_cartesian(xlim = c(-1.2, 1.2), ylim = c(-1.2, 1.2)) +
  theme_light() +
  labs(title = "Biplot entre Dimensiones 1 y 2 por año 2023") +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

Hallazgos

### **Análisis por región**

```{r modelo_regiones_contr, echo=FALSE, warning=FALSE, fig.width=10, fig.height=8}
region_list = c(
    "África - África Subsahariana",
    "África - Norte de África",
    "América - Latinoamérica y el Caribe",
    "América - Norteamérica",
    "Asia - Asia Central y del Sur",
    "Asia - Oriente Medio",
    "Asia del Este, Pacífico y Oceanía",
    "Europa - Europa del Este",
    "Europa - Europa Occidental"
  )
regions = as.data.frame(res.dmfa$quali.sup$coord)
regions$Region = rownames(regions)

regions_filt = regions %>%
  filter(Region == region_list)

regions_filt = regions_filt %>%
  pivot_longer(cols = dims_plot, names_to = "Dim", values_to = "Carga") %>%
  mutate(Signo = if_else(Carga >= 0, "Positivo", "Negativo"))

ggplot(regions_filt, aes(x = Carga, y = Region, fill = Signo)) +
  geom_col(width = 0.8, alpha = 0.95) +
  facet_wrap(~ Dim, scales = "free_y") +
  scale_fill_manual(values = c("Positivo" = "#2E8B57", "Negativo" = "#D73027")) + # verde/rojo
  labs(
    title = "Cargas por región y dimensión",
    x = "Carga (coordenada en la dimensión)",
    y = "Variable",
    fill = ""
  ) +
  theme_light() +
  theme(legend.position = "none")
```

Hallazgos

```{r analisis_region, echo=FALSE, warning=FALSE, fig.width=10, fig.height=8}
# Visualiza las modalidades de la variable cualitativa.
plot.DMFA(res.dmfa, choix="quali",invisible="quali", label="none")
```

Hallazgos

## 3. Conclusiones

Resuma las implicaciones del análisis, comentando sobre los patrones encontrados y su relevancia para la comprensión del desarrollo global.